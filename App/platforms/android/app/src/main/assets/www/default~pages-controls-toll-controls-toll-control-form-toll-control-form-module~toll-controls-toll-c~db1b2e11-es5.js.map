{"version":3,"sources":["webpack:///src/app/services/utils/date.service.ts","webpack:///src/app/pages/controls/toll-controls/toll-control-form/toll-control-form.page.html","webpack:///src/app/pages/controls/toll-controls/toll-control-form/toll-control-form.page.ts","webpack:///src/app/services/v1/toll-control.service.ts"],"names":["DateService","getToday","Date","getTime","getTimezoneOffset","toISOString","TollControlFormPage","formBuilder","router","authService","dateService","sanitizer","httpUploadFileService","toastComponent","cameraService","modalController","tollControlService","showInputErrorMessage","submitting","today","files","uploadedFilesIndexes","uploadingErrorFilesIndexes","maxYear","getFullYear","minYear","form","group","date","required","station","total","ngOnInit","tollControl","setTollControl","getAuthToken","then","authToken","controls","setValue","submit","valid","updateTollControl","storeTollControl","body","setBody","subscribe","response","tollControlId","toll_control_id","length","checkFiles","closeModal","error","uploadFiles","i","uploadingFileIndex","file","uploadFile","push","err","Promise","resolve","reject","toString","presentToast","value","viewControlImageDetail","create","component","componentProps","modal","present","takePicture","cameraPhotoFile","reset","dismiss","success","deleteImage","splice","TollControlService","http","API_URL","V1","getTollControls","month","year","get","post","put","id","deleteTollControl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAKaA,W;AAEX,+BAAc;AAAA;AACb;;;;iBAED,SAAAC,QAAQ,GAAG;AACT,mBAAO,IAAIC,IAAJ,CAAS,IAAIA,IAAJ,GAAWC,OAAX,KACd,IAAID,IAAJ,GAAWE,iBAAX,KAAiC,KAD5B,EACmCC,WADnC,EAAP;AAED;;;;;yBARUL,W;AAAW,O;;;eAAXA,W;AAAW,iBAAXA,WAAW,K;AAAA,oBAFV;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACwBR;;AACE;;AACF;;;;;;AAMA;;AACE;;AACF;;;;;;AAOA;;AACE;;AACF;;;;;;;;AAgBE;;AAA2C;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AAE3C;;;;;;AACA;;;;;;AAGA;;;;;;;;AAXF;;AACE;;AACK;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AADL;;AAIA;;AAGA;;AAGA;;AAEF;;;;;;;;;AAVO;;AAAA;;AAGM;;AAAA;;AAGA;;AAAA;;AAGQ;;AAAA;;;;;;AAMvB;;;;UCvDSM,mB;AAgBX,qCAAoBC,WAApB,EACoBC,MADpB,EAEoBC,WAFpB,EAGoBC,WAHpB,EAImBC,SAJnB,EAKoBC,qBALpB,EAMoBC,cANpB,EAOoBC,aAPpB,EAQoBC,eARpB,EASoBC,kBATpB,EAS4D;AAAA;;AATxC,eAAAT,WAAA,GAAAA,WAAA;AACA,eAAAC,MAAA,GAAAA,MAAA;AACA,eAAAC,WAAA,GAAAA,WAAA;AACA,eAAAC,WAAA,GAAAA,WAAA;AACD,eAAAC,SAAA,GAAAA,SAAA;AACC,eAAAC,qBAAA,GAAAA,qBAAA;AACA,eAAAC,cAAA,GAAAA,cAAA;AACA,eAAAC,aAAA,GAAAA,aAAA;AACA,eAAAC,eAAA,GAAAA,eAAA;AACA,eAAAC,kBAAA,GAAAA,kBAAA;AAtBpB,eAAAC,qBAAA,GAAwB,KAAxB;AACA,eAAAC,UAAA,GAAa,KAAb;AACA,eAAAC,KAAA,GAAQ,IAAIjB,IAAJ,EAAR;AAIA,eAAAkB,KAAA,GAA2B,EAA3B;AAEA,eAAAC,oBAAA,GAAiC,EAAjC;AACA,eAAAC,0BAAA,GAAuC,EAAvC;AAcE,eAAKC,OAAL,GAAe,KAAKJ,KAAL,CAAWK,WAAX,KAA2B,CAA1C;AACA,eAAKC,OAAL,GAAe,KAAKN,KAAL,CAAWK,WAAX,KAA2B,CAA1C;AAEA,eAAKE,IAAL,GAAY,KAAKnB,WAAL,CAAiBoB,KAAjB,CAAuB;AACjCC,gBAAI,EAAE,CAAC,EAAD,EAAK,0DAAWC,QAAhB,CAD2B;AAEjCC,mBAAO,EAAE,CAAC,EAAD,CAFwB;AAGjCC,iBAAK,EAAE,CAAC,EAAD;AAH0B,WAAvB,CAAZ;AAKD;;;;iBAED,SAAAC,QAAQ,GAAG;AAAA;;AACT,gBAAI,KAAKC,WAAT,EAAsB;AACpB,mBAAKC,cAAL;AACD;;AAED,iBAAKzB,WAAL,CAAiB0B,YAAjB,GAAgCC,IAAhC,CAAqC,UAAAC,SAAS,EAAI;AAChD,mBAAI,CAACA,SAAL,GAAiBA,SAAjB;AACD,aAFD;AAIA,iBAAKX,IAAL,CAAUY,QAAV,CAAmBV,IAAnB,CAAwBW,QAAxB,CAAiC,KAAK7B,WAAL,CAAiBT,QAAjB,EAAjC;AACD;;;iBAED,SAAAiC,cAAc,GAAG;AACf,iBAAKR,IAAL,CAAUY,QAAV,CAAmBV,IAAnB,CAAwBW,QAAxB,CAAiC,KAAKN,WAAL,CAAiBL,IAAlD;AACA,iBAAKF,IAAL,CAAUY,QAAV,CAAmBR,OAAnB,CAA2BS,QAA3B,CAAoC,KAAKN,WAAL,CAAiBH,OAArD;AACA,iBAAKJ,IAAL,CAAUY,QAAV,CAAmBP,KAAnB,CAAyBQ,QAAzB,CAAkC,KAAKN,WAAL,CAAiBF,KAAnD;AACD;;;iBAED,SAAAS,MAAM,GAAG;AACP,gBAAI,KAAKd,IAAL,CAAUe,KAAd,EAAqB;AACnB,mBAAKxB,qBAAL,GAA6B,KAA7B;AACA,mBAAKgB,WAAL,GAAmB,KAAKS,iBAAL,EAAnB,GAA8C,KAAKC,gBAAL,EAA9C;AACD,aAHD,MAGO;AACL,mBAAK1B,qBAAL,GAA6B,IAA7B;AACD;AACF;;;iBAED,SAAA0B,gBAAgB,GAAG;AAAA;;AACjB,iBAAKzB,UAAL,GAAkB,IAAlB;AACA,gBAAM0B,IAAI,GAAG,KAAKC,OAAL,EAAb;AACA,iBAAK7B,kBAAL,CAAwB2B,gBAAxB,CAAyCC,IAAzC,EACGE,SADH,CACa,UAACC,QAAD,EAAmB;AAC5B,oBAAI,CAACC,aAAL,GAAqBD,QAAQ,CAACE,eAA9B;;AACA,kBAAI,MAAI,CAAC7B,KAAL,CAAW8B,MAAX,GAAoB,CAAxB,EAA2B;AACzB,sBAAI,CAACC,UAAL;AACD,eAFD,MAEO;AACL,sBAAI,CAACC,UAAL;AACD;AACF,aARH,EAQK,UAAAC,KAAK,EAAI;AACV,oBAAI,CAACnC,UAAL,GAAkB,KAAlB;AACD,aAVH;AAWD;;;iBAED,SAAAwB,iBAAiB,GAAG;AAAA;;AAClB,iBAAKxB,UAAL,GAAkB,IAAlB;AACA,gBAAM0B,IAAI,GAAG,KAAKC,OAAL,EAAb;AACA,iBAAK7B,kBAAL,CAAwB0B,iBAAxB,CAA0C,KAAKT,WAA/C,EAA4DW,IAA5D,EACGE,SADH,CACa,UAACC,QAAD,EAAmB;AAC5B,oBAAI,CAACC,aAAL,GAAqBD,QAAQ,CAACE,eAA9B;;AACA,kBAAI,MAAI,CAAC7B,KAAL,CAAW8B,MAAX,GAAoB,CAAxB,EAA2B;AACzB,sBAAI,CAACC,UAAL;AACD,eAFD,MAEO;AACL,sBAAI,CAACC,UAAL;AACD;AACF,aARH,EAQK,UAAAC,KAAK,EAAI;AACV,oBAAI,CAACnC,UAAL,GAAkB,KAAlB;AACD,aAVH;AAWD;;;iBAEK,SAAAoC,WAAW,GAAG;;;;;;;;;AACdC,qB,GAAI,C;AACR,yBAAKC,kBAAL,GAA0BD,CAA1B;2DACmB,KAAKnC,K;;;;;;;;;;;AAAbqC,wB;;AACT,2BAAM,KAAKC,UAAL,CAAgBD,IAAI,CAACA,IAArB,EACHrB,IADG,CACE,YAAM;AACV,4BAAI,CAACf,oBAAL,CAA0BsC,IAA1B,CAA+BJ,CAA/B;AACD,qBAHG,WAIG,UAAAK,GAAG,EAAI;AACZ,4BAAI,CAACtC,0BAAL,CAAgCqC,IAAhC,CAAqCJ,CAArC;AACD,qBANG,aAMO,YAAM;AACfA,uBAAC;AACD,4BAAI,CAACC,kBAAL,GAA0BD,CAA1B;AACD,qBATG,CAAN;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWH;;;iBAED,SAAAG,UAAU,CAACD,IAAD,EAAK;AAAA;;AACb,mBAAO,IAAII,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,kBAAMnB,IAAI,GAAG;AACXK,+BAAe,EAAE,MAAI,CAACD,aAAL,CAAmBgB,QAAnB;AADN,eAAb;;AAGA,oBAAI,CAACpD,qBAAL,CAA2B8C,UAA3B,CAAsC,qBAAtC,EAA6DD,IAA7D,EAAmE,MAAI,CAACpB,SAAxE,EAAmFO,IAAnF,EACGR,IADH,CACQ,YAAM;AACV0B,uBAAO,CAAC,IAAD,CAAP;AACD,eAHH,WAIS,UAAAF,GAAG,EAAI;AACZG,sBAAM,CAACH,GAAD,CAAN;;AACA,sBAAI,CAAC/C,cAAL,CAAoBoD,YAApB,CAAiC,qEAAjC,EAAwG,QAAxG,EAAkH,IAAlH;AACD,eAPH;AAQD,aAZM,CAAP;AAaD;;;iBAED,SAAApB,OAAO,GAAG;AACR,mBAAO;AACLjB,kBAAI,EAAE,KAAKF,IAAL,CAAUwC,KAAV,CAAgBtC,IADjB;AAELE,qBAAO,EAAE,KAAKJ,IAAL,CAAUwC,KAAV,CAAgBpC,OAFpB;AAGLC,mBAAK,EAAE,KAAKL,IAAL,CAAUwC,KAAV,CAAgBnC;AAHlB,aAAP;AAKD;;;iBAEK,SAAAoC,sBAAsB,CAACV,IAAD,EAAwB;;;;;;;AACpC,2BAAM,KAAK1C,eAAL,CAAqBqD,MAArB,CAA4B;AAC9CC,+BAAS,EAAE,2GADmC;AAE9CC,oCAAc,EAAE;AAACb,4BAAI,EAAJA;AAAD;AAF8B,qBAA5B,CAAN;;;AAARc,yB;;AAIN,2BAAMA,KAAK,CAACC,OAAN,EAAN;;;;;;;AACD;;;iBAED,SAAAC,WAAW,GAAG;AAAA;;AACZ,iBAAK3D,aAAL,CAAmB2D,WAAnB,GAAiCrC,IAAjC,CAAsC,UAACsC,eAAD,EAAsC;AAC1E,oBAAI,CAACtD,KAAL,CAAWuC,IAAX,CAAgBe,eAAhB;AACD,aAFD,WAES,UAAAd,GAAG,EAAI;AACd,kBAAIA,GAAG,KAAK,mBAAZ,EAAiC;AAC/B,sBAAI,CAAC/C,cAAL,CAAoBoD,YAApB,qDAC4CL,GAD5C,QAEE,QAFF,EAGE,IAHF;AAKD;AACF,aAVD;AAWD;;;iBAED,SAAAT,UAAU,GAAG;AAAA;;AACX,iBAAK9B,oBAAL,GAA4B,EAA5B;AACA,iBAAKC,0BAAL,GAAkC,EAAlC;AAEA,iBAAKgC,WAAL,GAAmBlB,IAAnB,CAAwB,YAAM;AAC5B,oBAAI,CAACgB,UAAL;AACD,aAFD;AAGD;;;iBAED,SAAAA,UAAU,GAAG;AACX,iBAAK1B,IAAL,CAAUiD,KAAV;AACA,iBAAKzD,UAAL,GAAkB,KAAlB;AACA,iBAAK0D,OAAL,CAAa,IAAb;AACD;;;iBAED,SAAAA,OAAO,CAACC,OAAD,EAAU;AACf,iBAAK9D,eAAL,CAAqB6D,OAArB,CAA6B;AAACC,qBAAO,EAAPA;AAAD,aAA7B;AACD;;;iBAED,SAAAC,WAAW,CAACvB,CAAD,EAAI;AACb,iBAAKnC,KAAL,CAAW2D,MAAX,CAAkBxB,CAAlB,EAAqB,CAArB;AACD;;;;;yBAnLUjD,mB,EAAmB,4H,EAAA,wH,EAAA,uI,EAAA,2I,EAAA,wI,EAAA,iK,EAAA,kJ,EAAA,8I,EAAA,gI,EAAA,sJ;AAAA,O;;;cAAnBA,mB;AAAmB,8C;AAAA;AAAA;AAAA,S;AAAA,iB;AAAA,e;AAAA,gmD;AAAA;AAAA;ADpBhC;;AACE;;AACE;;AACE;;AAAuB;AAAA,qBAAS,IAAAsE,OAAA,CAAQ,KAAR,CAAT;AAAuB,aAAvB;;AAA0C;;AACnE;;AACA;;AAAW;;AAAc;;AAC3B;;AACF;;AAEA;;AACE;;AACE;;AACE;;AAAW;;AAAK;;AAChB;;AACE;;AAYF;;AACA;;AAGF;;AAEA;;AACE;;AAAW;;AAAQ;;AACnB;;AACA;;AAGF;;AAEA;;AACE;;AAAW;;AAAK;;AAEhB;;AACA;;AAGF;;AACF;;AAEA;;AAA4C;AAAA,qBAAS,IAAAH,WAAA,EAAT;AAAsB,aAAtB;;AAC1C;;AACA;;AACF;;AAEA;;AACE;;AACE;;AAcF;;AACF;;AAEA;;AACE;;AAEA;;AAEY;AAAA,qBAAS,IAAAjC,MAAA,EAAT;AAAiB,aAAjB;;AACV;;AACF;;AACF;;AACF;;;;AAzEQ;;AAAA;;AAMc;;AAAA,0FAAe,KAAf,EAAe,WAAf;;AAW6B;;AAAA;;AAQA;;AAAA;;AASA;;AAAA;;AAaV;;AAAA;;AAkBlB;;AAAA;;AAGP;;AAAA;;;;;;;;;;;;;;;;;;;;;AE7EhB;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;;UAOawC,kB;AAIX,oCAAoBC,IAApB,EAAsC;AAAA;;AAAlB,eAAAA,IAAA,GAAAA,IAAA;AAHpB,eAAAC,OAAA,GAAU,sEAAYA,OAAtB;AACA,eAAAC,EAAA,GAAK,SAAL;AAGC;;;;iBAED,SAAAC,eAAe,CAACC,KAAD,EAAQC,IAAR,EAAc;AAC3B,mBAAO,KAAKL,IAAL,CAAUM,GAAV,WAAiB,KAAKL,OAAtB,SAAgC,KAAKC,EAArC,iCAA8DE,KAA9D,mBAA4EC,IAA5E,EAAP;AACD;;;iBAED,SAAA3C,gBAAgB,CAACC,IAAD,EAAO;AACrB,mBAAO,KAAKqC,IAAL,CAAUO,IAAV,WAAkB,KAAKN,OAAvB,SAAiC,KAAKC,EAAtC,oBAAyDvC,IAAzD,CAAP;AACD;;;iBAED,SAAAF,iBAAiB,CAACT,WAAD,EAA2BW,IAA3B,EAAiC;AAChD,mBAAO,KAAKqC,IAAL,CAAUQ,GAAV,WAAiB,KAAKP,OAAtB,SAAgC,KAAKC,EAArC,2BAAwDlD,WAAW,CAACyD,EAApE,GAA0E9C,IAA1E,CAAP;AACD;;;iBAED,SAAA+C,iBAAiB,CAAC1D,WAAD,EAA2B;AAC1C,mBAAO,KAAKgD,IAAL,qBAAoB,KAAKC,OAAzB,SAAmC,KAAKC,EAAxC,2BAA2DlD,WAAW,CAACyD,EAAvE,EAAP;AACD;;;;;yBArBUV,kB,EAAkB,uH;AAAA,O;;;eAAlBA,kB;AAAkB,iBAAlBA,kBAAkB,K;AAAA,oBAFjB","file":"default~pages-controls-toll-controls-toll-control-form-toll-control-form-module~toll-controls-toll-c~db1b2e11-es5.js","sourcesContent":["import {Injectable} from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DateService {\n\n  constructor() {\n  }\n\n  getToday() {\n    return new Date(new Date().getTime() -\n      new Date().getTimezoneOffset() * 60000).toISOString();\n  }\n}\n","<ion-header>\n  <ion-toolbar>\n    <ion-buttons slot=\"end\">\n      <ion-icon name=\"close\" (click)=\"dismiss(false)\" class=\"font-2em\"></ion-icon>\n    </ion-buttons>\n    <ion-title>CONTROL PEAJES</ion-title>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content class=\"ion-text-center\">\n  <form [formGroup]=\"form\">\n    <div class=\"form-group\">\n      <ion-label>Fecha</ion-label>\n      <ion-item lines=\"none\" class=\"custom-item\">\n        <ion-datetime displayFormat=\"DD MMMM YYYY\"\n                      display-timezone=\"America/Argentina/Buenos_Aires\"\n                      [max]=\"maxYear\"\n                      [min]=\"minYear\"\n                      formControlName=\"date\"\n                      doneText=\"ok\"\n                      cancelText=\"cancelar\"\n                      monthNames=\"enero, febrero, marzo, abril, mayo, junio, julio, agosto, septiembre, octubre, noviembre, diciembre\"\n                      monthShortNames=\"ene, feb, mar, abr, may, jun, jul, ago, sep, oct, nov, dic\"\n                      dayNames=\"domingo, lunes, martes, miércoles, jueves, viernes, sábado, domingo\"\n                      dayShortNames=\"dom, lun, mar, mié, jue, vie, sáb, dom\">\n        </ion-datetime>\n      </ion-item>\n      <p class=\"ion-no-margin form-error-message\" *ngIf=\"form.controls.date.invalid && showInputErrorMessage\">\n        Este campo es requerido\n      </p>\n    </div>\n\n    <div class=\"form-group\">\n      <ion-label>Estación</ion-label>\n      <input type=\"text\" formControlName=\"station\">\n      <p class=\"ion-no-margin form-error-message\" *ngIf=\"form.controls.station.invalid && showInputErrorMessage\">\n        Este campo es requerido\n      </p>\n    </div>\n\n    <div class=\"form-group\">\n      <ion-label>Total</ion-label>\n      <!--      <input type=\"tel\" inputmode=\"numeric\" pattern=\"[0-9]+(\\,[0-9][0-9]?)?\" formControlName=\"total\">-->\n      <input inputmode=\"decimal\" pattern=\"[0-9]+(\\.[0-9][0-9]?)?\" formControlName=\"total\">\n      <p class=\"ion-no-margin form-error-message\" *ngIf=\"form.controls.total.invalid && showInputErrorMessage\">\n        Este campo debe ser numérico, puede tener dos decimales\n      </p>\n    </div>\n  </form>\n\n  <ion-button class=\"custom-secondary-button\" (click)=\"takePicture()\">\n    <ion-icon name=\"camera\"></ion-icon>\n    Tomar foto\n  </ion-button>\n\n  <ion-grid>\n    <ion-row>\n      <ion-col size=\"6\" *ngFor=\"let file of files; let i=index\">\n        <img class=\"control-image\"\n             (click)=\"viewControlImageDetail(file)\"\n             [src]=\"sanitizer.bypassSecurityTrustUrl(file.src)\"\n             alt=\"control-image\">\n        <ion-icon name=\"trash\" class=\"delete-icon\" (click)=\"deleteImage(i)\"\n                  *ngIf=\"uploadedFilesIndexes.indexOf(i) <= -1\">\n        </ion-icon>\n        <ion-icon name=\"checkmark\" class=\"checkmark-icon\" color=\"success\"\n                  *ngIf=\"uploadedFilesIndexes.indexOf(i) > -1\">\n        </ion-icon>\n        <ion-progress-bar class=\"uploadingFile\" type=\"indeterminate\"\n                          *ngIf=\"uploadingFileIndex === i\"></ion-progress-bar>\n      </ion-col>\n    </ion-row>\n  </ion-grid>\n\n  <div class=\"ion-padding\">\n    <ion-progress-bar *ngIf=\"submitting\" type=\"indeterminate\">\n    </ion-progress-bar>\n    <ion-button class=\"custom-button\"\n                [disabled]=\"submitting\"\n                (click)=\"submit()\">\n      Aceptar\n    </ion-button>\n  </div>\n</ion-content>\n\n","import {Component, Input, OnInit} from '@angular/core';\nimport {FormBuilder, FormGroup, Validators} from '@angular/forms';\nimport {Router} from '@angular/router';\nimport {ModalController} from '@ionic/angular';\nimport {TollControl} from '../../../../interfaces/TollControl';\nimport {TollControlService} from '../../../../services/v1/toll-control.service';\nimport {ImageDetailComponent} from '../../../../components/modals/image-detail/image-detail.component';\nimport {CameraPhotoFile} from '../../../../interfaces/CameraPhotoFile';\nimport {ToastComponent} from '../../../../components/toast/toast.component';\nimport {CameraService} from '../../../../services/utils/camera.service';\nimport {AuthService} from '../../../../services/v1/auth.service';\nimport {DomSanitizer} from '@angular/platform-browser';\nimport {HttpUploadFileService} from '../../../../services/utils/http-upload-file.service';\nimport {DateService} from '../../../../services/utils/date.service';\n\n@Component({\n  selector: 'app-toll-control-form',\n  templateUrl: './toll-control-form.page.html',\n  styleUrls: ['./toll-control-form.page.scss'],\n})\nexport class TollControlFormPage implements OnInit {\n  @Input() tollControl: TollControl;\n  form: FormGroup;\n  showInputErrorMessage = false;\n  submitting = false;\n  today = new Date();\n  maxYear: number;\n  minYear: number;\n\n  files: CameraPhotoFile[] = [];\n  tollControlId: string;\n  uploadedFilesIndexes: number[] = [];\n  uploadingErrorFilesIndexes: number[] = [];\n  uploadingFileIndex: number;\n  authToken: string;\n\n  constructor(private formBuilder: FormBuilder,\n              private router: Router,\n              private authService: AuthService,\n              private dateService: DateService,\n              public sanitizer: DomSanitizer,\n              private httpUploadFileService: HttpUploadFileService,\n              private toastComponent: ToastComponent,\n              private cameraService: CameraService,\n              private modalController: ModalController,\n              private tollControlService: TollControlService) {\n    this.maxYear = this.today.getFullYear() + 2;\n    this.minYear = this.today.getFullYear() - 1;\n\n    this.form = this.formBuilder.group({\n      date: ['', Validators.required],\n      station: [''],\n      total: ['']\n    });\n  }\n\n  ngOnInit() {\n    if (this.tollControl) {\n      this.setTollControl();\n    }\n\n    this.authService.getAuthToken().then(authToken => {\n      this.authToken = authToken;\n    });\n\n    this.form.controls.date.setValue(this.dateService.getToday());\n  }\n\n  setTollControl() {\n    this.form.controls.date.setValue(this.tollControl.date);\n    this.form.controls.station.setValue(this.tollControl.station);\n    this.form.controls.total.setValue(this.tollControl.total);\n  }\n\n  submit() {\n    if (this.form.valid) {\n      this.showInputErrorMessage = false;\n      this.tollControl ? this.updateTollControl() : this.storeTollControl();\n    } else {\n      this.showInputErrorMessage = true;\n    }\n  }\n\n  storeTollControl() {\n    this.submitting = true;\n    const body = this.setBody();\n    this.tollControlService.storeTollControl(body)\n      .subscribe((response: any) => {\n        this.tollControlId = response.toll_control_id;\n        if (this.files.length > 0) {\n          this.checkFiles();\n        } else {\n          this.closeModal();\n        }\n      }, error => {\n        this.submitting = false;\n      });\n  }\n\n  updateTollControl() {\n    this.submitting = true;\n    const body = this.setBody();\n    this.tollControlService.updateTollControl(this.tollControl, body)\n      .subscribe((response: any) => {\n        this.tollControlId = response.toll_control_id;\n        if (this.files.length > 0) {\n          this.checkFiles();\n        } else {\n          this.closeModal();\n        }\n      }, error => {\n        this.submitting = false;\n      });\n  }\n\n  async uploadFiles() {\n    let i = 0;\n    this.uploadingFileIndex = i;\n    for (const file of this.files) {\n      await this.uploadFile(file.file)\n        .then(() => {\n          this.uploadedFilesIndexes.push(i);\n        })\n        .catch(err => {\n          this.uploadingErrorFilesIndexes.push(i);\n        }).finally(() => {\n          i++;\n          this.uploadingFileIndex = i;\n        });\n    }\n  }\n\n  uploadFile(file): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const body = {\n        toll_control_id: this.tollControlId.toString()\n      };\n      this.httpUploadFileService.uploadFile('toll-control-images', file, this.authToken, body)\n        .then(() => {\n          resolve(true);\n        })\n        .catch(err => {\n          reject(err);\n          this.toastComponent.presentToast('No se pudo carga la imagen del control de peaje. Intente nuevamente', 'medium', 2500);\n        });\n    });\n  }\n\n  setBody() {\n    return {\n      date: this.form.value.date,\n      station: this.form.value.station,\n      total: this.form.value.total,\n    };\n  }\n\n  async viewControlImageDetail(file: CameraPhotoFile) {\n    const modal = await this.modalController.create({\n      component: ImageDetailComponent,\n      componentProps: {file}\n    });\n    await modal.present();\n  }\n\n  takePicture() {\n    this.cameraService.takePicture().then((cameraPhotoFile: CameraPhotoFile) => {\n      this.files.push(cameraPhotoFile);\n    }).catch(err => {\n      if (err !== 'No Image Selected') {\n        this.toastComponent.presentToast(\n          `No se pudo acceder a la cámara (error: ${err})`,\n          'middle',\n          3000,\n        );\n      }\n    });\n  }\n\n  checkFiles() {\n    this.uploadedFilesIndexes = [];\n    this.uploadingErrorFilesIndexes = [];\n\n    this.uploadFiles().then(() => {\n      this.closeModal();\n    });\n  }\n\n  closeModal() {\n    this.form.reset();\n    this.submitting = false;\n    this.dismiss(true);\n  }\n\n  dismiss(success) {\n    this.modalController.dismiss({success});\n  }\n\n  deleteImage(i) {\n    this.files.splice(i, 1);\n  }\n\n}\n","import {Injectable} from '@angular/core';\nimport {environment} from '../../../environments/environment';\nimport {HttpClient} from '@angular/common/http';\nimport {TollControl} from '../../interfaces/TollControl';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TollControlService {\n  API_URL = environment.API_URL;\n  V1 = 'v1/app/';\n\n  constructor(private http: HttpClient) {\n  }\n\n  getTollControls(month, year) {\n    return this.http.get(`${this.API_URL}${this.V1}toll-controls/month/${month}/year/${year}`);\n  }\n\n  storeTollControl(body) {\n    return this.http.post(`${this.API_URL}${this.V1}toll-controls`, body);\n  }\n\n  updateTollControl(tollControl: TollControl, body) {\n    return this.http.put(`${this.API_URL}${this.V1}toll-controls/${tollControl.id}`, body);\n  }\n\n  deleteTollControl(tollControl: TollControl) {\n    return this.http.delete(`${this.API_URL}${this.V1}toll-controls/${tollControl.id}`);\n  }\n}\n"]}