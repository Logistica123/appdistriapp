{"version":3,"sources":["webpack:///src/app/services/utils/call-number.service.ts","webpack:///src/app/components/popovers/delivery-priority-select/delivery-priority-select.component.html","webpack:///src/app/components/popovers/delivery-priority-select/delivery-priority-select.component.ts","webpack:///src/app/pages/delivery-map/delivery-map.page.html","webpack:///src/app/pages/delivery-map/delivery-map.page.ts"],"names":["CallNumberService","callNumber","call","phoneNumber","then","res","console","log","err","DeliveryPrioritySelectComponent","options","ngOnInit","setOptions","i","length","push","selectOption","option","detail","value","DeliveryMapPage","orderService","router","activatedRoute","callNumberService","modalController","popoverController","geolocationService","currentOrderIndex","notDeliveringOrder","deliveringOrder","skipping","radius","showAllMarkersFlag","markersOrders","ordersOptimized","type","snapshot","paramMap","get","ngAfterViewInit","currentOrdersSubscription","getCurrentOrders$","subscribe","orders","tryOptimizeOrders","currentOrder","selectedOrder","findNearbyMarkers","checkWatchLocationsSubscription","driverPosition","getDriverPosition","driverGeolocationSubscription","driverPosition$","ngOnDestroy","unsubscribe","watchPosition","viewDeliveryOrderMap","navigateByUrl","selectOrder","ev","deliverOrder","create","component","componentProps","order","modal","present","onWillDismiss","data","success","status","status_es","skip","showNotDeliverOptions","cssClass","showDeliveryOrderOptions","popover","onDidDismiss","phone","navigateBack","coords","window","google","maps","geometry","spherical","optimized","getOptimizedOrderSequence","remaining","currentPoint","LatLng","latitude","longitude","nearestIdx","nearestDistance","Number","POSITIVE_INFINITY","forEach","index","location","lat","lng","orderPoint","distance","computeDistanceBetween","nextOrder","splice","anotherOrders","filter","id","circle","Circle","strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","center","nearbyOrders","getCenter","updateMarkersOrders","toggleAllMarkers","showAllMarkers","hideAllMarkers"],"mappings":"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","file":"default~pages-delivery-map-delivery-map-module~pages-journeys-journey-list-journey-list-module-es5.js","sourcesContent":["import {Injectable} from '@angular/core';\nimport {CallNumber} from '@ionic-native/call-number/ngx';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CallNumberService {\n\n  constructor(private callNumber: CallNumber) {\n  }\n\n  call(phoneNumber: string) {\n    this.callNumber.callNumber(phoneNumber, true)\n      .then(res => console.log('Launched dialer!', res))\n      .catch(err => {});\n  }\n}\n","<ion-content>\n  <ion-item>\n    <ion-label>Seleccione</ion-label>\n    <ion-select okText=\"Ok\" cancelText=\"Cancelar\" (ionChange)=\"selectOption($event)\">\n      <ion-select-option *ngFor=\"let option of options\" [value]=\"option\">{{option}}</ion-select-option>\n    </ion-select>\n  </ion-item>\n</ion-content>\n\n\n","import {Component, Input, OnInit} from '@angular/core';\n\n@Component({\n  selector: 'app-delivery-priority-select',\n  templateUrl: './delivery-priority-select.component.html',\n  styleUrls: ['./delivery-priority-select.component.scss'],\n})\nexport class DeliveryPrioritySelectComponent implements OnInit {\n  @Input() length: number;\n  options: number[] = [];\n\n  constructor() {\n  }\n\n  ngOnInit() {\n    this.setOptions();\n  }\n\n  setOptions() {\n    for (let i = 1; i < this.length; i++) {\n      this.options.push(i);\n    }\n  }\n\n  selectOption(option) {\n    console.log(option.detail.value);\n    console.log('selected option', option);\n  }\n\n}\n","<ion-header>\n  <ion-toolbar>\n    <ion-buttons slot=\"start\">\n      <ion-button (click)=\"navigateBack()\">\n        <ion-icon slot=\"icon-only\" name=\"arrow-back\"></ion-icon>\n      </ion-button>\n    </ion-buttons>\n    <ion-buttons slot=\"end\" *ngIf=\"selectedOrder\">\n      <ion-button href='https://api.whatsapp.com/send/?phone={{selectedOrder.phone}}&text=Hola'>\n        <ion-icon slot=\"icon-only\" name=\"logo-whatsapp\"></ion-icon>\n      </ion-button>\n\n      <ion-button *ngIf=\"selectedOrder\" (click)=\"callNumber(selectedOrder)\">\n        <ion-icon slot=\"icon-only\" name=\"call-outline\"></ion-icon>\n      </ion-button>\n\n<!--      <ion-button (click)=\"toggleAllMarkers()\">-->\n<!--        <ion-icon slot=\"icon-only\" name=\"map-outline\" [color]=\"showAllMarkersFlag ? 'warning' : 'light'\"></ion-icon>-->\n<!--      </ion-button>-->\n\n      <ion-button (click)=\"viewDeliveryOrderMap()\">\n        <ion-icon slot=\"icon-only\" name=\"map-outline\"></ion-icon>\n      </ion-button>\n    </ion-buttons>\n    <ion-title>Mapa de entregas</ion-title>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content>\n  <app-map [currentOrder]=\"currentOrder\"\n           [nearbyOrders]=\"nearbyOrders\"\n           [markersOrders]=\"markersOrders\"\n           [driverPosition]=\"driverPosition\"\n           [orders]=\"orders\"\n           [radius]=\"radius\"\n           (deliverOrderEvent)=\"deliverOrder()\"\n           (notDeliverOrderEvent)=\"showNotDeliverOptions()\"\n           (updateDeliveryOrderEvent)=\"showDeliveryOrderOptions()\"\n           (selectOrderEvent)=\"selectOrder($event)\">\n  </app-map>\n\n  <div class=\"ion-text-center\">\n    <h6 class=\"ion-no-margin\">\n      <b>{{selectedOrder?.location.address}}</b>\n    </h6>\n    <p class=\"ion-no-margin\">\n      {{selectedOrder?.receiver}} ({{selectedOrder?.phone}})\n    </p>\n    <p class=\"ion-no-margin\">{{selectedOrder?.description ? selectedOrder?.description : ' -'}}</p>\n  </div>\n</ion-content>\n\n<ion-footer>\n  <ion-toolbar>\n    <ion-grid class=\"ion-no-padding\">\n      <ion-row>\n        <ion-col size=\"4\" class=\"ion-no-padding\">\n          <ion-tab-button (click)=\"deliverOrder()\">\n            <ion-icon name=\"checkmark-done\" *ngIf=\"!deliveringOrder\"></ion-icon>\n            <ion-spinner name=\"bubbles\" *ngIf=\"deliveringOrder\"></ion-spinner>\n            <ion-label *ngIf=\"!deliveringOrder\">Entregar</ion-label>\n            <ion-label *ngIf=\"deliveringOrder\">Entregando...</ion-label>\n          </ion-tab-button>\n        </ion-col>\n        <ion-col size=\"4\" class=\"ion-no-padding\">\n          <ion-tab-button (click)=\"showNotDeliverOptions()\">\n            <ion-icon name=\"alert-circle\" *ngIf=\"!notDeliveringOrder\"></ion-icon>\n            <ion-spinner name=\"bubbles\" *ngIf=\"notDeliveringOrder\"></ion-spinner>\n            <ion-label *ngIf=\"!notDeliveringOrder\">No entregado</ion-label>\n            <ion-label *ngIf=\"notDeliveringOrder\">No entregado...</ion-label>\n          </ion-tab-button>\n        </ion-col>\n        <ion-col size=\"4\" class=\"ion-no-padding\">\n          <ion-tab-button (click)=\"skip()\">\n            <ion-icon name=\"arrow-forward-circle\" *ngIf=\"!skipping\"></ion-icon>\n            <ion-spinner name=\"bubbles\" *ngIf=\"skipping\"></ion-spinner>\n            <ion-label *ngIf=\"!skipping\">Saltar</ion-label>\n            <ion-label *ngIf=\"skipping\">Saltando...</ion-label>\n          </ion-tab-button>\n        </ion-col>\n      </ion-row>\n    </ion-grid>\n  </ion-toolbar>\n</ion-footer>\n","import {AfterViewInit, Component, ElementRef, Input, OnDestroy, OnInit, ViewChild} from '@angular/core';\nimport {OrderService} from '../../services/v1/order.service';\nimport {ActivatedRoute, Router} from '@angular/router';\nimport {Order} from '../../interfaces/Order';\nimport {GeolocationService} from '../../services/v1/geolocation.service';\nimport {IonTabs, ModalController, PopoverController} from '@ionic/angular';\nimport {DeliverOrderComponent} from '../../components/modals/deliver-order/deliver-order.component';\nimport {CallNumberService} from '../../services/utils/call-number.service';\nimport {NotDeliveredComponent} from '../../components/modals/not-delivered/not-delivered.component';\nimport {Geoposition} from '@ionic-native/geolocation';\nimport {Circle, Environment, GoogleMap, GoogleMapOptions, GoogleMaps, ILatLng, Marker} from '@ionic-native/google-maps';\nimport {DeliveryPrioritySelectComponent} from '../../components/popovers/delivery-priority-select/delivery-priority-select.component';\n\ndeclare var google;\n\n@Component({\n  selector: 'app-delivery-map',\n  templateUrl: './delivery-map.page.html',\n  styleUrls: ['./delivery-map.page.scss'],\n})\nexport class DeliveryMapPage implements OnInit, AfterViewInit, OnDestroy {\n  orders: Order[];\n  nearbyOrders: Order[];\n  driverPosition: Geoposition;\n  currentOrder: Order;\n  selectedOrder: Order;\n  currentOrderIndex = 0;\n  driverGeolocationSubscription: any;\n  currentOrdersSubscription: any;\n  notDeliveringOrder = false;\n  deliveringOrder = false;\n  skipping = false;\n  radius = 1500;\n  showAllMarkersFlag = false;\n  type: string;\n  markersOrders: Order[] = [];\n  ordersOptimized = false;\n\n  // @ViewChild('deliveryMap', {static: true}) mapElement: ElementRef;\n  // map: GoogleMap;\n  // driverMarker: Marker;\n  // markers: Marker[] = [];\n  // circle: Circle;\n\n  constructor(private orderService: OrderService,\n              private router: Router,\n              private activatedRoute: ActivatedRoute,\n              private callNumberService: CallNumberService,\n              private modalController: ModalController,\n              private popoverController: PopoverController,\n              private geolocationService: GeolocationService) {\n    this.type = this.activatedRoute.snapshot.paramMap.get('type');\n  }\n\n  ngOnInit() {\n    //\n  }\n\n  ngAfterViewInit() {\n    this.currentOrdersSubscription = this.orderService.getCurrentOrders$()\n      .subscribe(orders => {\n        this.orders = orders;\n        this.ordersOptimized = false;\n        console.log(this.orders);\n        this.tryOptimizeOrders();\n        this.currentOrder = this.orders[this.currentOrderIndex];\n        this.selectedOrder = this.currentOrder;\n        console.log(this.currentOrder);\n        this.findNearbyMarkers();\n      });\n\n    this.checkWatchLocationsSubscription();\n\n    this.driverPosition = this.geolocationService.getDriverPosition();\n    this.driverGeolocationSubscription = this.geolocationService.driverPosition$\n      .subscribe(driverPosition => {\n        if (driverPosition) {\n          this.driverPosition = driverPosition;\n          this.tryOptimizeOrders();\n        }\n      });\n  }\n\n  ngOnDestroy(): void {\n    if (this.driverGeolocationSubscription) {\n      this.driverGeolocationSubscription.unsubscribe();\n    }\n\n    if (this.currentOrdersSubscription) {\n      this.currentOrdersSubscription.unsubscribe();\n    }\n  }\n\n\n  checkWatchLocationsSubscription() {\n    console.log(this.geolocationService.checkWatchLocationsSubscription());\n    if (!this.geolocationService.checkWatchLocationsSubscription()) {\n      this.geolocationService.watchPosition();\n    }\n  }\n\n  viewDeliveryOrderMap() {\n    // this.showAllMarkers = !this.showAllMarkers;\n    // this.nearbyOrders = this.orders;\n    this.router.navigateByUrl('all-orders-map');\n  }\n\n  selectOrder(ev) {\n    this.selectedOrder = ev;\n    console.log(this.selectedOrder);\n  }\n\n  async deliverOrder() {\n    const modal = await this.modalController.create({\n      component: DeliverOrderComponent,\n      componentProps: {order: this.selectedOrder},\n    });\n    await modal.present();\n    const {data} = await modal.onWillDismiss();\n    if (data?.success) {\n      this.selectedOrder.status = 'delivered';\n      this.selectedOrder.status_es = 'entregada';\n      this.skip();\n    }\n  }\n\n  async showNotDeliverOptions() {\n    const modal = await this.modalController.create({\n      component: NotDeliveredComponent,\n      cssClass: 'modal-not-deliver-options',\n      componentProps: {order: this.selectedOrder},\n    });\n    await modal.present();\n    const {data} = await modal.onWillDismiss();\n    if (data?.success) {\n      this.selectedOrder.status = 'not-delivered';\n      this.selectedOrder.status_es = 'no entregada';\n      this.skip();\n    }\n  }\n\n  async showDeliveryOrderOptions() {\n    const popover = await this.popoverController.create({\n      component: DeliveryPrioritySelectComponent,\n      componentProps: {length: this.orders.length},\n    });\n    await popover.present();\n    const {data} = await popover.onDidDismiss();\n    console.log(data);\n  }\n\n  callNumber(order: Order) {\n    this.callNumberService.call(order.phone);\n  }\n\n  navigateBack() {\n    this.type === 'urban-distribution'\n      ? this.router.navigateByUrl('urban-distribution-list')\n      : this.router.navigateByUrl('journey-list');\n  }\n\n  skip() {\n    this.currentOrderIndex + 1 >= this.orders.length\n      ? this.currentOrderIndex = 0\n      : this.currentOrderIndex++;\n\n    this.currentOrder = this.orders[this.currentOrderIndex];\n    this.selectedOrder = this.currentOrder;\n    this.findNearbyMarkers();\n  }\n\n  private tryOptimizeOrders() {\n    if (this.ordersOptimized) {\n      return;\n    }\n\n    if (!this.orders || this.orders.length === 0) {\n      return;\n    }\n\n    if (!this.driverPosition || !this.driverPosition.coords) {\n      return;\n    }\n\n    if (!(window as any).google || !google.maps?.geometry?.spherical) {\n      return;\n    }\n\n    const optimized = this.getOptimizedOrderSequence();\n    if (optimized.length === this.orders.length) {\n      this.orders = optimized;\n      this.currentOrderIndex = 0;\n      this.currentOrder = this.orders[this.currentOrderIndex];\n      this.selectedOrder = this.currentOrder;\n      this.ordersOptimized = true;\n    }\n  }\n\n  private getOptimizedOrderSequence(): Order[] {\n    const remaining = [...this.orders];\n    const optimized: Order[] = [];\n    let currentPoint = new google.maps.LatLng(this.driverPosition.coords.latitude, this.driverPosition.coords.longitude);\n\n    while (remaining.length > 0) {\n      let nearestIdx = 0;\n      let nearestDistance = Number.POSITIVE_INFINITY;\n\n      remaining.forEach((order, index) => {\n        if (!order?.location?.lat || !order?.location?.lng) {\n          return;\n        }\n        const orderPoint = new google.maps.LatLng(+order.location.lat, +order.location.lng);\n        const distance = google.maps.geometry.spherical.computeDistanceBetween(currentPoint, orderPoint);\n        if (distance < nearestDistance) {\n          nearestDistance = distance;\n          nearestIdx = index;\n        }\n      });\n\n      const nextOrder = remaining.splice(nearestIdx, 1)[0];\n      optimized.push(nextOrder);\n      currentPoint = new google.maps.LatLng(+nextOrder.location.lat, +nextOrder.location.lng);\n    }\n\n    return optimized;\n  }\n\n  findNearbyMarkers() {\n    console.log('finding nearby orders...');\n    const anotherOrders = this.orders.filter(order => order.id !== +this.currentOrder.id);\n\n    const circle = new google.maps.Circle({\n      strokeColor: 'black',\n      strokeOpacity: 0.8,\n      strokeWeight: 2,\n      fillColor: 'blue',\n      fillOpacity: 0.35,\n      center: new google.maps.LatLng(+this.currentOrder.location.lat, +this.currentOrder.location.lng),\n      radius: this.radius\n    });\n\n    this.nearbyOrders = anotherOrders.filter(order =>\n      google.maps.geometry.spherical.computeDistanceBetween(\n        new google.maps.LatLng(+order.location.lat, +order.location.lng),\n        circle.getCenter()) <= this.radius\n    );\n    this.updateMarkersOrders();\n  }\n\n  toggleAllMarkers() {\n    this.showAllMarkersFlag = !this.showAllMarkersFlag;\n    this.updateMarkersOrders();\n  }\n\n  updateMarkersOrders() {\n    this.showAllMarkersFlag ? this.showAllMarkers() : this.hideAllMarkers();\n  }\n\n  showAllMarkers() {\n    console.log(this.nearbyOrders);\n    this.markersOrders = this.orders.filter(order => order.id !== this.currentOrder.id);\n  }\n\n  hideAllMarkers() {\n    console.log(this.nearbyOrders);\n    this.markersOrders = [];\n  }\n}\n"]}