{"version":3,"sources":["webpack:///src/app/services/utils/file-chooser.service.ts","webpack:///src/app/pages/maintenance/document-file-form/document-file-form.page.html","webpack:///src/app/pages/maintenance/document-file-form/document-file-form.page.ts","webpack:///src/app/services/v1/document.service.ts"],"names":["FileChooserService","fileChooser","filePath","file","chooseFile","Promise","resolve","reject","open","then","uri","resolveNativePath","filename","substring","lastIndexOf","path","readFile","documentFile","err","readAsDataURL","res","src","copyFile","fileName","newPath","newFileName","split","join","DocumentFileFormPage","documentService","modalController","cameraService","sanitizer","httpUploadFileService","storage","authService","toastComponent","fileChooserService","documents","documentFormControl","loading","files","documentFiles","uploadedFilesIndexes","uploadingErrorFilesIndexes","uploadedDocumentFilesIndexes","uploadingErrorDocumentFilesIndexes","submitting","documentsUpdated","ngOnInit","getDocumentsByDocumentType","getAuthToken","authToken","ngOnDestroy","setUpdatedDocuments$","documentTypeId","subscribe","response","error","takePicture","cameraPhotoFile","push","presentToast","alert","JSON","stringify","viewControlImageDetail","create","component","componentProps","modal","present","deleteImage","i","splice","deleteDocumentFile","submit","body","document_id","value","storeUploadedDocument","uploadedDocumentId","uploaded_document","id","length","checkFiles","closeModal","uploadFiles","dismiss","uploadingFileIndex","uploadFile","uploadingDocumentFileIndex","uploaded_document_id","toString","success","DocumentService","http","API_URL","V1","updatedDocuments$","getDocumentTypes","get","documentType","getUploadedDocuments","post","deleteUploadedDocument","uploadedDocument","getUpdatedDocuments$","asObservable","updated","next"],"mappings":"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","file":"default~pages-maintenance-document-file-form-document-file-form-module~pages-maintenance-document-fo~c271ae65-es5.js","sourcesContent":["import {Injectable} from '@angular/core';\nimport {FileChooser} from '@ionic-native/file-chooser/ngx';\nimport {CameraPhotoFile} from '../../interfaces/CameraPhotoFile';\nimport {FilePath} from '@ionic-native/file-path/ngx';\nimport {File} from '@ionic-native/file/ngx';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FileChooserService {\n\n  constructor(private fileChooser: FileChooser,\n              private filePath: FilePath,\n              private file: File) {\n  }\n\n  chooseFile() {\n    return new Promise((resolve, reject) => {\n      this.fileChooser.open()\n        .then(uri => {\n          this.filePath.resolveNativePath(uri).then(filePath => {\n            const filename = filePath.substring(filePath.lastIndexOf('/') + 1);\n            const path = filePath.substring(0, filePath.lastIndexOf('/') + 1);\n            // if (filename.indexOf(' ') > -1) {\n            //   const newFilename = filename.split(' ').join('_');\n            //   this.copyFile(path, filename, path, newFilename).then((val) => {\n            //     this.readFile(path, newFilename).then(documentFile => {\n            //       resolve(documentFile);\n            //     }).catch(err => {\n            //       reject(err);\n            //     });\n            //   });\n            // } else {\n            //   this.readFile(path, filename).then(documentFile => {\n            //     resolve(documentFile);\n            //   }).catch(err => {\n            //     reject(err);\n            //   });\n            // }\n            this.readFile(path, filename).then(documentFile => {\n              resolve(documentFile);\n            }).catch(err => {\n              reject(err);\n            });\n          }).catch(err => {\n            reject(err);\n          });\n        }).catch(err => {\n        reject(err);\n      });\n    });\n  }\n\n  readFile(path, filename) {\n    return new Promise((resolve, reject) => {\n      this.file.readAsDataURL(path, filename)\n        .then(res => {\n          const documentFile: CameraPhotoFile = {\n            file: path + '/' + filename,\n            src: res,\n            filename,\n            path\n          };\n          resolve(documentFile);\n        })\n        .catch(err => {\n          reject(err);\n        });\n    });\n  }\n\n  copyFile(path: string, fileName: string, newPath: string, newFileName: string) {\n    return new Promise((resolve, reject) => {\n      this.file.copyFile(path, fileName, newPath, newFileName.split(' ').join('_'))\n        .then(() => {\n          resolve(newFileName);\n        }).catch(err => {\n        reject(err);\n      });\n    });\n  }\n}\n","<ion-header>\n  <ion-toolbar>\n    <ion-buttons slot=\"end\">\n      <ion-button (click)=\"dismiss(false)\">\n        <ion-icon slot=\"icon-only\" name=\"close\"></ion-icon>\n      </ion-button>\n    </ion-buttons>\n    <ion-title>CARGAR DOCUMENTO</ion-title>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content>\n  <ion-progress-bar class=\"ion-margin-top\"\n                    type=\"indeterminate\"\n                    *ngIf=\"loading\">\n  </ion-progress-bar>\n\n  <ion-list *ngIf=\"!loading\">\n    <ion-radio-group [formControl]=\"documentFormControl\">\n      <ion-list-header>\n        Tipo de documento\n      </ion-list-header>\n\n      <ion-item lines=\"none\" *ngFor=\"let document of documents\">\n        <ion-label>{{document.name}}</ion-label>\n        <ion-radio [value]=\"document.id\"></ion-radio>\n      </ion-item>\n    </ion-radio-group>\n  </ion-list>\n\n  <div class=\"ion-text-center\" *ngIf=\"!loading\">\n    <ion-button class=\"custom-secondary-button\" (click)=\"takePicture()\">\n      <ion-icon name=\"camera\"></ion-icon>\n      Tomar foto\n    </ion-button>\n\n    <ion-button class=\"custom-secondary-button\" (click)=\"chooseFile()\">\n      <ion-icon name=\"document-attach\"></ion-icon>\n      Seleccionar documento\n    </ion-button>\n  </div>\n\n  <ion-grid>\n    <ion-row class=\"ion-text-center\">\n      <ion-col size=\"6\" *ngFor=\"let file of files; let i=index\">\n        <img class=\"control-image\"\n             (click)=\"viewControlImageDetail(file)\"\n             [src]=\"sanitizer.bypassSecurityTrustUrl(file.src)\"\n             alt=\"control-image\">\n        <ion-icon name=\"trash\" class=\"delete-icon\" (click)=\"deleteImage(i)\"\n                  *ngIf=\"uploadedFilesIndexes.indexOf(i) <= -1\">\n        </ion-icon>\n        <ion-icon name=\"checkmark\" class=\"checkmark-icon\" color=\"success\"\n                  *ngIf=\"uploadedFilesIndexes.indexOf(i) > -1\">\n        </ion-icon>\n        <ion-progress-bar type=\"indeterminate\" *ngIf=\"uploadingFileIndex === i\">\n        </ion-progress-bar>\n      </ion-col>\n    </ion-row>\n  </ion-grid>\n\n  <ion-grid>\n    <ion-row *ngFor=\"let file of documentFiles; let i=index\">\n      <ion-col size=\"9\" >\n        <ion-label>\n          {{file.filename}}\n        </ion-label>\n\n        <ion-progress-bar type=\"indeterminate\" *ngIf=\"uploadingFileIndex === i\">\n        </ion-progress-bar>\n      </ion-col>\n\n      <ion-col size=\"3\">\n        <ion-icon name=\"trash\" (click)=\"deleteDocumentFile(i)\"\n                  *ngIf=\"uploadedDocumentFilesIndexes.indexOf(i) <= -1\">\n        </ion-icon>\n        <ion-icon name=\"checkmark\" color=\"success\"\n                  *ngIf=\"uploadedDocumentFilesIndexes.indexOf(i) > -1\">\n        </ion-icon>\n      </ion-col>\n    </ion-row>\n  </ion-grid>\n\n  <div class=\"ion-padding ion-text-center\">\n    <ion-progress-bar *ngIf=\"submitting\" type=\"indeterminate\">\n    </ion-progress-bar>\n    <ion-button class=\"custom-button\"\n                [disabled]=\"!documentFormControl.value || submitting\"\n                (click)=\"submit()\">\n      Aceptar\n    </ion-button>\n  </div>\n</ion-content>\n","import {Component, Input, OnDestroy, OnInit} from '@angular/core';\nimport {DocumentService} from '../../../services/v1/document.service';\nimport {Document} from '../../../interfaces/Document';\nimport {FormControl} from '@angular/forms';\nimport {ModalController} from '@ionic/angular';\nimport {CameraService} from '../../../services/utils/camera.service';\nimport {Storage} from '@ionic/storage';\nimport {HttpUploadFileService} from '../../../services/utils/http-upload-file.service';\nimport {ToastComponent} from '../../../components/toast/toast.component';\nimport {CameraPhotoFile} from '../../../interfaces/CameraPhotoFile';\nimport {ImageDetailComponent} from '../../../components/modals/image-detail/image-detail.component';\nimport {DomSanitizer} from '@angular/platform-browser';\nimport {AuthService} from '../../../services/v1/auth.service';\nimport {FileChooserService} from '../../../services/utils/file-chooser.service';\n\n@Component({\n  selector: 'app-document-file-form',\n  templateUrl: './document-file-form.page.html',\n  styleUrls: ['./document-file-form.page.scss'],\n})\nexport class DocumentFileFormPage implements OnInit, OnDestroy {\n  @Input() documentTypeId: number;\n  documents: Document[] = [];\n  documentFormControl = new FormControl();\n  loading = false;\n\n  files: CameraPhotoFile[] = [];\n  documentFiles: CameraPhotoFile[] = [];\n  uploadedDocumentId: number;\n\n  uploadedFilesIndexes: number[] = [];\n  uploadingErrorFilesIndexes: number[] = [];\n  uploadingFileIndex: number;\n\n  uploadedDocumentFilesIndexes: number[] = [];\n  uploadingErrorDocumentFilesIndexes: number[] = [];\n  uploadingDocumentFileIndex: number;\n\n  authToken: string;\n  submitting = false;\n  documentsUpdated = false;\n\n  constructor(private documentService: DocumentService,\n              private modalController: ModalController,\n              private cameraService: CameraService,\n              public sanitizer: DomSanitizer,\n              private httpUploadFileService: HttpUploadFileService,\n              private storage: Storage,\n              private authService: AuthService,\n              private toastComponent: ToastComponent,\n              private fileChooserService: FileChooserService) {\n  }\n\n  ngOnInit() {\n    this.getDocumentsByDocumentType();\n\n    this.authService.getAuthToken().then(authToken => {\n      this.authToken = authToken;\n    });\n  }\n\n  ngOnDestroy(): void {\n    if (this.documentsUpdated) {\n      this.documentService.setUpdatedDocuments$(this.documentsUpdated);\n    }\n  }\n\n  getDocumentsByDocumentType() {\n    this.loading = true;\n    this.documentService.getDocumentsByDocumentType(this.documentTypeId)\n      .subscribe((response: any) => {\n        this.documents = response.documents;\n        this.loading = false;\n      }, error => {\n        this.loading = false;\n      });\n  }\n\n  takePicture() {\n    this.cameraService.takePicture().then((cameraPhotoFile: CameraPhotoFile) => {\n      this.files.push(cameraPhotoFile);\n    }).catch(err => {\n      this.toastComponent.presentToast(\n        `No se pudo acceder a la cÃ¡mara (error: ${err})`,\n        'middle',\n        3000,\n      );\n    });\n  }\n\n\n  chooseFile() {\n    this.fileChooserService.chooseFile().then((documentFile: CameraPhotoFile) => {\n      this.documentFiles.push(documentFile);\n    }).catch(err => {\n      alert(JSON.stringify(err));\n      this.toastComponent.presentToast(\n        `No se pudo seleccionar el archivo (error: ${err})`,\n        'middle',\n        3000,\n      );\n    });\n  }\n\n  async viewControlImageDetail(file: CameraPhotoFile) {\n    const modal = await this.modalController.create({\n      component: ImageDetailComponent,\n      componentProps: {file}\n    });\n    await modal.present();\n  }\n\n  deleteImage(i) {\n    this.files.splice(i, 1);\n  }\n\n  deleteDocumentFile(i) {\n    this.documentFiles.splice(i, 1);\n  }\n\n  submit() {\n    const body = {\n      document_id: this.documentFormControl.value\n    };\n    this.documentService.storeUploadedDocument(body)\n      .subscribe((response: any) => {\n        this.documentsUpdated = true;\n        this.uploadedDocumentId = response.uploaded_document.id;\n        if (this.files.length > 0 || this.documentFiles.length > 0) {\n          this.checkFiles();\n        } else {\n          this.closeModal();\n        }\n      }, error => {\n\n      }, () => {\n\n      });\n  }\n\n  checkFiles() {\n    this.uploadedFilesIndexes = [];\n    this.uploadingErrorFilesIndexes = [];\n\n    this.uploadedDocumentFilesIndexes = [];\n    this.uploadingErrorDocumentFilesIndexes = [];\n\n    this.uploadFiles().then(() => {\n      this.closeModal();\n    });\n  }\n\n  closeModal() {\n    this.submitting = false;\n    this.dismiss(true);\n  }\n\n  async uploadFiles() {\n    let i = 0;\n    this.uploadingFileIndex = i;\n    for (const file of this.files) {\n      await this.uploadFile(file.file)\n        .then(() => {\n          this.uploadedFilesIndexes.push(i);\n        })\n        .catch(err => {\n          this.uploadingErrorFilesIndexes.push(i);\n        }).finally(() => {\n          i++;\n          this.uploadingFileIndex = i;\n        });\n    }\n\n    for (const file of this.documentFiles) {\n      await this.uploadFile(file.file)\n        .then(() => {\n          this.uploadedDocumentFilesIndexes.push(i);\n        })\n        .catch(err => {\n          this.uploadingErrorDocumentFilesIndexes.push(i);\n        }).finally(() => {\n          i++;\n          this.uploadingDocumentFileIndex = i;\n        });\n    }\n  }\n\n  uploadFile(file): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const body = {\n        uploaded_document_id: this.uploadedDocumentId.toString()\n      };\n      this.httpUploadFileService.uploadFile('document-files', file, this.authToken, body)\n        .then(() => {\n          resolve(true);\n        })\n        .catch(err => {\n          reject(err);\n          this.toastComponent.presentToast('No se pudo cargar el archivo. Intente nuevamente', 'medium', 2500);\n        });\n    });\n  }\n\n  dismiss(success) {\n    this.modalController.dismiss({success});\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {environment} from '../../../environments/environment';\nimport {HttpClient} from '@angular/common/http';\nimport {BehaviorSubject, Observable} from 'rxjs';\nimport {UploadedDocument} from '../../interfaces/UploadedDocument';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DocumentService {\n  API_URL = environment.API_URL;\n  V1 = 'v1/app/';\n\n  private updatedDocuments$ = new BehaviorSubject<boolean>(false);\n\n  constructor(private http: HttpClient) {\n  }\n\n  getDocumentTypes() {\n    return this.http.get(`${this.API_URL}${this.V1}document-types`);\n  }\n\n  getDocumentsByDocumentType(documentType) {\n    return this.http.get(`${this.API_URL}${this.V1}document-types/${documentType}/documents`);\n  }\n\n  getUploadedDocuments() {\n    return this.http.get(`${this.API_URL}${this.V1}uploaded-documents`);\n  }\n\n  storeUploadedDocument(body) {\n    return this.http.post(`${this.API_URL}${this.V1}uploaded-documents`, body);\n  }\n\n  deleteUploadedDocument(uploadedDocument: UploadedDocument) {\n    return this.http.delete(`${this.API_URL}${this.V1}uploaded-documents/${uploadedDocument.id}`);\n  }\n\n  getUpdatedDocuments$(): Observable<boolean> {\n    return this.updatedDocuments$.asObservable();\n  }\n\n  setUpdatedDocuments$(updated: boolean) {\n    this.updatedDocuments$.next(updated);\n  }\n}\n"]}