{"version":3,"sources":["webpack:///src/app/services/v1/delivery.service.ts","webpack:///src/app/pages/delivery-order-map/delivery-order-map.module.ts","webpack:///src/app/pages/delivery-order-map/delivery-order-map.page.ts","webpack:///src/app/pages/delivery-order-map/delivery-order-map.page.html","webpack:///src/app/pages/delivery-order-map/delivery-order-map-routing.module.ts"],"names":["DeliveryService","orders","currentOrder","DeliveryOrderMapPageModule","DeliveryOrderMapPage","modalController","geolocation","deliveryService","orderService","markers","radius","htmlInfoWindow","ngOnInit","console","log","ngAfterViewInit","setTimeout","subscribe","length","loadMap","ionViewWillLeave","watchLocationObservable","unsubscribe","watchLocation","watchPosition","enableHighAccuracy","position","coords","accuracy","driverPosition","google","maps","LatLng","latitude","longitude","driverMarker","setPosition","alert","setEnv","API_KEY_FOR_BROWSER_RELEASE","API_KEY_FOR_BROWSER_DEBUG","mapOptions","camera","target","lat","location","lng","zoom","tilt","map","create","center","moveCamera","circle","addCircleSync","strokeColor","strokeWidth","fillColor","visible","addCurrentOrderMarker","findNearbyMarkers","addMarker","icon","animation","then","marker","setCenter","on","MARKER_CLICK","m","selectedOrder","close","setInfoWindowContent","open","removeAllMarkers","remove","viewAllMarkers","setVisible","anotherOrders","filter","order","id","status","bounds","extend","push","showMarkersByNumber","min","max","Circle","strokeOpacity","strokeWeight","fillOpacity","ordersInRadius","geometry","spherical","computeDistanceBetween","getCenter","frame","document","createElement","innerHTML","address","receiver","description","join","getElementsByClassName","addEventListener","setContent","width","classList","add","dismiss","routes","path","component","DeliveryOrderMapPageRoutingModule","forChild"],"mappings":"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","file":"pages-delivery-order-map-delivery-order-map-module-es5.js","sourcesContent":["import {Injectable} from '@angular/core';\nimport {BehaviorSubject} from 'rxjs';\nimport {Order} from '../../interfaces/Order';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DeliveryService {\n  // type: this.type,\n  // orders: this.orders,\n  // currentOrder: this.currentOrder\n\n  orders = new BehaviorSubject<Order[]>([]);\n  currentOrder = new BehaviorSubject<Order>(null);\n\n  constructor() {\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport {FormsModule, ReactiveFormsModule} from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { DeliveryOrderMapPageRoutingModule } from './delivery-order-map-routing.module';\n\nimport { DeliveryOrderMapPage } from './delivery-order-map.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    IonicModule,\n    DeliveryOrderMapPageRoutingModule\n  ],\n  declarations: [DeliveryOrderMapPage]\n})\nexport class DeliveryOrderMapPageModule {}\n","import {AfterViewInit, Component, ElementRef, Input, OnInit, ViewChild} from '@angular/core';\nimport {OrderService} from '../../services/v1/order.service';\nimport {Order} from '../../interfaces/Order';\nimport {\n  Circle,\n  Environment,\n  GoogleMap,\n  GoogleMapOptions,\n  GoogleMaps,\n  GoogleMapsEvent,\n  HtmlInfoWindow,\n  ILatLng, LatLngBounds,\n  Marker\n} from '@ionic-native/google-maps';\nimport {ModalController} from '@ionic/angular';\nimport {Geolocation, Geoposition} from '@ionic-native/geolocation/ngx';\nimport {DeliveryService} from '../../services/v1/delivery.service';\n\n\n@Component({\n  selector: 'app-delivery-order-map',\n  templateUrl: './delivery-order-map.page.html',\n  styleUrls: ['./delivery-order-map.page.scss'],\n})\nexport class DeliveryOrderMapPage implements OnInit, AfterViewInit {\n\n  orders: Order[] = [];\n  currentOrder: Order;\n  selectedOrder: Order;\n  map: GoogleMap;\n  @ViewChild('deliveryOrderMarkersMap', {static: true}) mapElement: ElementRef;\n  watchLocationObservable: any;\n  driverMarker: google.maps.Marker;\n  markers: Marker[] = [];\n  radius = 250;\n  circle: Circle;\n  htmlInfoWindow = new HtmlInfoWindow();\n\n  constructor(private modalController: ModalController,\n              private geolocation: Geolocation,\n              private deliveryService: DeliveryService,\n              private orderService: OrderService) {\n\n  }\n\n  ngOnInit() {\n    console.log('delivery-order-map...!');\n  }\n\n  ngAfterViewInit(): void {\n    setTimeout(() => {\n      this.deliveryService.currentOrder.subscribe(currentOrder => {\n        if (currentOrder) {\n          this.currentOrder = currentOrder;\n          this.deliveryService.orders.subscribe(orders => {\n            if (orders.length > 0) {\n              this.orders = orders;\n              this.loadMap();\n            }\n          });\n        }\n      });\n    }, 2500);\n  }\n\n  ionViewWillLeave() {\n    if (this.watchLocationObservable) {\n      this.watchLocationObservable.unsubscribe();\n    }\n  }\n\n  watchLocation() {\n    this.watchLocationObservable = this.geolocation.watchPosition({enableHighAccuracy: true})\n      .subscribe((position: Geoposition) => {\n        console.log('got in modal ***__');\n        if (position && position.coords && position.coords.accuracy <= 50) {\n          const driverPosition = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);\n          // const driverPosition = new google.maps.LatLng(-27.497737, -58.828180);\n          this.driverMarker.setPosition(driverPosition);\n          // this.map.setCenter(driverPosition);\n        } else {\n          alert('No se pudo obtener ubicación actual del conductor. Por favor habilite el GPS en su dispositivo móvil');\n        }\n      });\n  }\n\n  loadMap() {\n    Environment.setEnv({\n      API_KEY_FOR_BROWSER_RELEASE: 'AIzaSyCQ5AidfjBOg7VI2sgkbpnKHPBGAoLQ15w',\n      API_KEY_FOR_BROWSER_DEBUG: 'AIzaSyCQ5AidfjBOg7VI2sgkbpnKHPBGAoLQ15w'\n    });\n\n    const mapOptions: GoogleMapOptions = {\n      camera: {\n        target: {\n          lat: +this.currentOrder.location.lat,\n          lng: +this.currentOrder.location.lng\n        },\n        zoom: 18,\n        tilt: 30\n      }\n    };\n\n    this.map = GoogleMaps.create('deliveryOrderMarkersMap', mapOptions);\n\n    const center: ILatLng = {lat: +this.currentOrder.location.lat, lng: +this.currentOrder.location.lng};\n\n    this.map.moveCamera({\n      target: center\n    });\n\n    this.circle = this.map.addCircleSync({\n      center,\n      radius: this.radius,\n      strokeColor: 'rgba(250, 250, 250, 0.6)',\n      strokeWidth: 0,\n      fillColor: 'rgba(250, 250, 250, 0.6)',\n      visible: false\n    });\n    this.addCurrentOrderMarker();\n    // this.selectedOrder = this.currentOrder;\n    this.findNearbyMarkers();\n    // this.addMarkers();\n    // this.getCurrentDriverPosition();\n  }\n\n  addCurrentOrderMarker() {\n    const position: ILatLng = {lat: +this.currentOrder.location.lat, lng: +this.currentOrder.location.lng};\n    this.map.addMarker({\n      icon: 'red',\n      animation: 'DROP',\n      position\n    }).then(marker => {\n      // this.markers.push(marker);\n      this.circle.setCenter(position);\n\n      marker.on(GoogleMapsEvent.MARKER_CLICK).subscribe((m) => {\n        this.selectedOrder = this.currentOrder;\n        this.htmlInfoWindow.close();\n        this.setInfoWindowContent(this.selectedOrder);\n        this.htmlInfoWindow.open(marker);\n      });\n    });\n  }\n\n  // initMap() {\n  //   setTimeout(() => {\n  //     const lat = +this.orders[0].location.lat;\n  //     const lng = +this.orders[0].location.lng;\n  //     const center = new google.maps.LatLng(lat, lng);\n  //     this.map = new google.maps.Map(this.mapElement.nativeElement, {\n  //       zoom: 12,\n  //       center\n  //     });\n  //     this.addMarkers();\n  //     this.getCurrentDriverPosition();\n  //   }, 1000);\n  // }\n\n  // addMarkers() {\n  //   let i = 1;\n  //   const colors = [\n  //     'yellow', 'green', 'blue'\n  //   ];\n  //   this.orders.map(order => {\n  //     const contentString = `<h4>${order.location.name}</h4><p>${order.location.full_address}</p>`;\n  //     const infoWindow = new google.maps.InfoWindow({\n  //       content: contentString\n  //     });\n  //\n  //     const random = Math.floor(Math.random() * 3) + 1;\n  //     let url = 'http://maps.google.com/mapfiles/ms/icons/';\n  //     url += colors[random - 1] + '-dot.png';\n  //\n  //     const marker = new google.maps.Marker({\n  //       position: new google.maps.LatLng(+order.location.lat, +order.location.lng),\n  //       map: this.map,\n  //       label: {\n  //         text: i.toString(),\n  //         color: 'black',\n  //         fontSize: '24px'\n  //       },\n  //       icon: {\n  //         url\n  //       }\n  //       // icon: order.status === 'delivered' ? 'assets/markers/location-delivered.png' : 'assets/markers/location.png'\n  //     });\n  //\n  //     marker.addListener('click', () => {\n  //       infoWindow.open(this.map, marker);\n  //     });\n  //\n  //     this.markers.push(marker);\n  //     i++;\n  //   });\n  // }\n\n  removeAllMarkers() {\n    this.markers.map(marker => {\n      marker.remove();\n    });\n    this.markers = [];\n  }\n\n  viewAllMarkers() {\n    this.removeAllMarkers();\n    this.circle.setVisible(false);\n    const anotherOrders = this.orders.filter(order =>\n      order.id !== this.currentOrder.id && order.status !== 'delivered');\n\n    const bounds: LatLngBounds = new LatLngBounds([\n      {lat: +this.currentOrder.location.lat, lng: +this.currentOrder.location.lng}\n    ]);\n\n    anotherOrders.map(order => {\n      const position: ILatLng = {lat: +order.location.lat, lng: +order.location.lng};\n      bounds.extend(position);\n      this.map.addMarker({\n        icon: 'blue',\n        animation: 'DROP',\n        position\n      }).then(marker => {\n        this.markers.push(marker);\n        marker.on(GoogleMapsEvent.MARKER_CLICK).subscribe((m) => {\n          this.selectedOrder = order;\n          this.htmlInfoWindow.close();\n          this.setInfoWindowContent(order);\n          this.htmlInfoWindow.open(marker);\n        });\n      });\n    });\n\n\n    this.map.moveCamera({\n      target: bounds\n    });\n  }\n\n  showMarkersByNumber(min, max) {\n    // this.markers.map(marker => {\n    //   marker.setMap(null);\n    // });\n    // this.markers = [];\n    // const colors = [\n    //   'yellow', 'green', 'blue'\n    // ];\n    //\n    // for (let i = min - 1; i <= max - 1; i++) {\n    //   const order = this.orders[i];\n    //   if (order) {\n    //     const contentString = `<h4>${order.location.name}</h4><p>${order.location.full_address}</p>`;\n    //     const infoWindow = new google.maps.InfoWindow({\n    //       content: contentString\n    //     });\n    //\n    //     const random = Math.floor(Math.random() * 3) + 1;\n    //     let url = 'http://maps.google.com/mapfiles/ms/icons/';\n    //     url += colors[random - 1] + '-dot.png';\n    //\n    //     const marker = new google.maps.Marker({\n    //       position: new google.maps.LatLng(+order.location.lat, +order.location.lng),\n    //       map: this.map,\n    //       label: {\n    //         text: (i + 1).toString(),\n    //         color: 'black',\n    //         fontSize: '24px'\n    //       },\n    //       icon: {\n    //         url\n    //       }\n    //       // icon: order.status === 'delivered' ? 'assets/markers/location-delivered.png' : 'assets/markers/location.png'\n    //     });\n    //\n    //     marker.addListener('click', () => {\n    //       infoWindow.open(this.map, marker);\n    //     });\n    //\n    //     this.markers.push(marker);\n    //   }\n    // }\n  }\n\n  findNearbyMarkers() {\n    this.removeAllMarkers();\n    const anotherOrders = this.orders.filter(order =>\n      order.id !== this.currentOrder.id && order.status !== 'delivered');\n\n    const circle = new google.maps.Circle({\n      strokeColor: 'black',\n      strokeOpacity: 0.8,\n      strokeWeight: 2,\n      fillColor: 'blue',\n      fillOpacity: 0.35,\n      center: new google.maps.LatLng(+this.currentOrder.location.lat, +this.currentOrder.location.lng),\n      radius: this.radius\n    });\n\n    const ordersInRadius = anotherOrders.filter(order =>\n      google.maps.geometry.spherical.computeDistanceBetween(\n        new google.maps.LatLng(+order.location.lat, +order.location.lng),\n        circle.getCenter()) <= this.radius\n    );\n\n    const bounds: LatLngBounds = new LatLngBounds([\n      {lat: +this.currentOrder.location.lat, lng: +this.currentOrder.location.lng}\n    ]);\n\n    ordersInRadius.map(order => {\n      const position: ILatLng = {lat: +order.location.lat, lng: +order.location.lng};\n      bounds.extend(position);\n      this.map.addMarker({\n        icon: 'blue',\n        animation: 'DROP',\n        position\n      }).then(marker => {\n        this.markers.push(marker);\n        marker.on(GoogleMapsEvent.MARKER_CLICK).subscribe((m) => {\n          this.selectedOrder = order;\n          this.htmlInfoWindow.close();\n          this.setInfoWindowContent(order);\n          this.htmlInfoWindow.open(marker);\n        });\n      });\n    });\n    this.circle.setVisible(true);\n    this.map.moveCamera({\n      target: bounds\n    });\n  }\n\n  setInfoWindowContent(order: Order) {\n    const frame: HTMLElement = document.createElement('div');\n    // frame.className = 'map-info-window';\n    frame.innerHTML = [\n      `<h6 style=\"margin: 0; padding: 0\">${order.location.address}</h6>`,\n\n      `<p style=\"margin: 0; padding: 0\">${order.receiver}</p>`,\n\n      `<p style=\"margin: 0; padding: 0\">${order.description}</p>`,\n\n      '<span class=\"close-iw\" style=\"top: 5px; right: 5px; position: absolute\">' +\n      '&times' +\n      '</span>',\n    ].join('');\n    frame.getElementsByClassName('close-iw')[0].addEventListener('click', () => {\n      this.htmlInfoWindow.close();\n    });\n    this.htmlInfoWindow.setContent(frame, {\n      width: '200px',\n      // height: '330px'\n    });\n\n    frame.classList.add('map-info-window');\n  }\n\n  dismiss() {\n    this.modalController.dismiss();\n  }\n\n}\n","<ion-header>\n  <ion-toolbar color=\"primary\">\n    <ion-button>\n      <ion-icon name=\"close\" slot=\"icon-only\"></ion-icon>\n    </ion-button>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content>\n  <div #deliveryOrderMarkersMap id=deliveryOrderMarkersMap>\n\n  </div>\n</ion-content>\n\n<ion-footer>\n  <ion-toolbar>\n    <ion-button color=\"primary\" size=\"full\" shape=\"round\" (click)=\"viewAllMarkers()\">\n      Ver todos los pendientes\n    </ion-button>\n    <ion-button color=\"primary\" size=\"full\" shape=\"round\" (click)=\"findNearbyMarkers()\">\n      Ver pendientes cercanos\n    </ion-button>\n  </ion-toolbar>\n</ion-footer>\n\n\n<!--<ion-grid>-->\n<!--  <ion-row>-->\n<!--    <ion-col>-->\n<!--      <ion-button (click)=\"showMarkersByNumber(1, 10)\">1-10</ion-button>-->\n<!--    </ion-col>-->\n<!--    <ion-col>-->\n<!--      <ion-button (click)=\"showMarkersByNumber(11, 20)\">11-20</ion-button>-->\n<!--    </ion-col>-->\n<!--    <ion-col>-->\n<!--      <ion-button (click)=\"showMarkersByNumber(21, 30)\">21-30</ion-button>-->\n<!--    </ion-col>-->\n<!--    <ion-col>-->\n<!--      <ion-button (click)=\"showMarkersByNumber(31, 40)\">31-40</ion-button>-->\n<!--    </ion-col>-->\n<!--  </ion-row>-->\n\n<!--  <ion-row>-->\n<!--    <ion-col>-->\n<!--      <ion-button (click)=\"showMarkersByNumber(41, 50)\">41-50</ion-button>-->\n<!--    </ion-col>-->\n<!--    <ion-col>-->\n<!--      <ion-button (click)=\"showMarkersByNumber(51, 60)\">51-60</ion-button>-->\n<!--    </ion-col>-->\n<!--    <ion-col>-->\n<!--      <ion-button (click)=\"showMarkersByNumber(61, 70)\">61-70</ion-button>-->\n<!--    </ion-col>-->\n<!--    <ion-col>-->\n<!--      <ion-button (click)=\"showMarkersByNumber(71, 80)\">71-80</ion-button>-->\n<!--    </ion-col>-->\n<!--  </ion-row>-->\n<!--</ion-grid>-->\n\n<!--<ion-button (click)=\"showMarkersByNumber(81, 90)\">81-90</ion-button>-->\n<!--<ion-button (click)=\"showMarkersByNumber(81, 90)\">todos</ion-button>-->\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { DeliveryOrderMapPage } from './delivery-order-map.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: DeliveryOrderMapPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class DeliveryOrderMapPageRoutingModule {}\n"]}