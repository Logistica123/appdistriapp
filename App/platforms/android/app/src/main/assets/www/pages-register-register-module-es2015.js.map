{"version":3,"sources":["./src/app/pages/register/register-routing.module.ts","./src/app/pages/register/register.module.ts","./src/app/pages/register/register.page.ts","./src/app/pages/register/register.page.html"],"names":[],"mappings":"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","file":"pages-register-register-module-es2015.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { RegisterPage } from './register.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: RegisterPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class RegisterPageRoutingModule {}\n","import {NgModule} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {FormsModule, ReactiveFormsModule} from '@angular/forms';\n\nimport {IonicModule} from '@ionic/angular';\n\nimport {RegisterPageRoutingModule} from './register-routing.module';\n\nimport {RegisterPage} from './register.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    IonicModule,\n    RegisterPageRoutingModule\n  ],\n  declarations: [RegisterPage]\n})\nexport class RegisterPageModule {\n}\n","import {Component, OnDestroy, OnInit} from '@angular/core';\nimport {FormBuilder, FormGroup, Validators} from \"@angular/forms\";\nimport {DriverService} from \"../../services/v2/driver.service\";\nimport {Router} from \"@angular/router\";\nimport {ToastController} from \"@ionic/angular\";\nimport {Subscription} from \"rxjs\";\nimport {debounceTime, distinctUntilChanged} from \"rxjs/operators\";\n\n@Component({\n  selector: 'app-register',\n  templateUrl: './register.page.html',\n  styleUrls: ['./register.page.scss'],\n})\nexport class RegisterPage implements OnInit, OnDestroy {\n  form: FormGroup;\n  confirmedPassword = true;\n  private cuilSubscription: Subscription;\n\n  constructor(private formBuilder: FormBuilder,\n              private router: Router,\n              private driverService: DriverService,\n              private toastController: ToastController) {\n    this.form = this.formBuilder.group({\n      name: ['', Validators.required],\n      last_name: ['', Validators.required],\n      email: ['', Validators.required],\n      cuil: ['', [Validators.required, Validators.pattern('^\\\\d{11}$')]],\n      phone_number: [''],\n      license_plate: [''],\n      city: [''],\n      car_make: [''],\n      car_model: [''],\n      car_year: [''],\n      company: [''],\n      password: ['', Validators.required],\n      password_confirmation: ['', Validators.required],\n    });\n\n    this.subscribeToCuilChanges();\n    this.resetForm();\n  }\n\n  ngOnInit() {\n  }\n\n  ionViewWillEnter() {\n    this.resetForm();\n  }\n\n  ngOnDestroy() {\n    if (this.cuilSubscription) {\n      this.cuilSubscription.unsubscribe();\n    }\n  }\n\n  submit() {\n    if (this.confirmedPassword && this.form.valid) {\n      const body = this.setBody();\n      this.driverService.register(body)\n        .subscribe((response: any) => {\n          this.resetForm();\n          this.router.navigateByUrl('login');\n        }, async error => {\n          await this.presentToast(error?.error?.message || 'No se pudo registrar el conductor', 'danger');\n        });\n    }\n  }\n\n  validatePassword() {\n    this.confirmedPassword = this.form.value.password === this.form.value.password_confirmation;\n  }\n\n  setBody() {\n    return {\n      name: this.form.value.name,\n      last_name: this.form.value.last_name,\n      email: this.form.value.email,\n      cuil: this.form.value.cuil,\n      phone_number: this.form.value.phone_number,\n      city: this.form.value.city,\n      car_make: this.form.value.car_make,\n      car_model: this.form.value.car_model,\n      car_year: this.form.value.car_year,\n      license_plate: this.form.value.license_plate,\n      company: this.form.value.company,\n      password: this.form.value.password,\n      password_confirmation: this.form.value.password_confirmation,\n    };\n  }\n\n  private subscribeToCuilChanges() {\n    this.cuilSubscription = this.form.get('cuil')?.valueChanges\n      .pipe(\n        debounceTime(400),\n        distinctUntilChanged()\n      )\n      .subscribe((cuil: string) => {\n        if (cuil && cuil.length === 11) {\n          this.lookupByCuil(cuil);\n        } else {\n          this.clearPersonalData();\n        }\n      });\n  }\n\n  private lookupByCuil(cuil: string) {\n    this.driverService.lookupByCuil(cuil).subscribe(async (response: any) => {\n      if (response?.person) {\n        this.form.patchValue({\n          name: response.person.name || '',\n          last_name: response.person.last_name || '',\n          email: response.person.email || '',\n          phone_number: response.person.phone_number || '',\n          license_plate: response.person.license_plate || '',\n          company: response.person.company || ''\n        }, {emitEvent: false});\n      }\n    }, async error => {\n      this.clearPersonalData();\n      if (error.status === 404) {\n        await this.presentToast('CUIL no encontrado en Personal', 'warning');\n      } else if (error.status === 422) {\n        await this.presentToast('Formato de CUIL inválido', 'warning');\n      } else {\n        await this.presentToast('No se pudo consultar la base de Personal', 'danger');\n      }\n    });\n  }\n\n  private clearPersonalData() {\n    this.form.patchValue({\n      name: '',\n      last_name: '',\n      email: '',\n      phone_number: '',\n      license_plate: '',\n      city: '',\n      car_make: '',\n      car_model: '',\n      car_year: '',\n      company: ''\n    }, {emitEvent: false});\n  }\n\n  private resetForm() {\n    this.form.reset({\n      name: '',\n      last_name: '',\n      email: '',\n      cuil: '',\n      phone_number: '',\n      license_plate: '',\n      city: '',\n      car_make: '',\n      car_model: '',\n      car_year: '',\n      company: '',\n      password: '',\n      password_confirmation: ''\n    });\n    this.form.markAsPristine();\n    this.form.markAsUntouched();\n  }\n\n  private async presentToast(message: string, color: 'warning' | 'danger' = 'warning') {\n    const toast = await this.toastController.create({\n      message,\n      duration: 2500,\n      color,\n      position: 'top'\n    });\n    await toast.present();\n  }\n}\n","<ion-header class=\"ion-no-border\">\n  <ion-toolbar mode=\"ios\">\n    <ion-buttons slot=\"start\">\n      <ion-back-button color=\"dark\" defaultHref=\"login\"></ion-back-button>\n    </ion-buttons>\n    <ion-title color=\"primary\">Crear cuenta</ion-title>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content>\n  <div class=\"content\">\n    <form [formGroup]=\"form\">\n      <div class=\"form-group\">\n        <input type=\"text\" placeholder=\"Nombre\" formControlName=\"name\">\n      </div>\n      <div class=\"form-group\">\n        <input type=\"text\" placeholder=\"Apellido\" formControlName=\"last_name\">\n      </div>\n      <div class=\"form-group\">\n        <input type=\"text\" placeholder=\"Correo electrónico\" formControlName=\"email\" inputmode=\"email\">\n      </div>\n      <div class=\"form-group\">\n        <input type=\"text\" placeholder=\"CUIL (11 dígitos)\" formControlName=\"cuil\" inputmode=\"numeric\">\n      </div>\n      <div class=\"form-group\">\n        <input type=\"password\" placeholder=\"Contraseña\" formControlName=\"password\">\n      </div>\n      <div class=\"form-group\">\n        <input type=\"password\" placeholder=\"Confirmar contraseña\" formControlName=\"password_confirmation\">\n      </div>\n    </form>\n\n    <div class=\"ion-text-center ion-margin\">\n      <button (click)=\"submit()\" [disabled]=\"!form.valid\">\n        ACEPTAR\n      </button>\n    </div>\n  </div>\n</ion-content>\n"],"sourceRoot":"webpack:///"}