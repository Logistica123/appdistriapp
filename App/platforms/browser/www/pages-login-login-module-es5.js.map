{"version":3,"sources":["webpack:///src/app/pages/login/login.module.ts","webpack:///src/app/pages/login/login-routing.module.ts","webpack:///src/app/pages/login/login.page.html","webpack:///src/app/pages/login/login.page.ts"],"names":["LoginPageModule","routes","path","component","LoginPageRoutingModule","forChild","LoginPage","storage","formBuilder","driverService","deviceService","locationAccuracy","geolocationService","router","locationService","platform","alertController","afAuth","afs","authService","loading","checkingCredentials","signInForm","group","email","required","password","checkbox","ngOnInit","Promise","all","get","then","values","remember","authToken","console","log","is","watchPosition","navigate","requestLocationAccuracy","signIn","credentials","value","set","subscribe","response","driver","setProfile","setLocations$","locations","admin_email","auth_token","storeDevice","error","register","navigateByUrl","canRequest","request","REQUEST_PRIORITY_HIGH_ACCURACY","presentAlert","err","setDriver$","create","message","buttons","alert","present","createFirebaseUser","createUserWithEmailAndPassword","uid","user"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;;UAmBaA,e;;;;;yBAAAA,e;AAAe,O;;;cAAfA;;;kBATF,CACP,4DADO,EAEP,0DAFO,EAGP,kEAHO,EAIP,0DAJO,EAKP,4EALO,C;;;;4HASEA,e,EAAe;AAAA,yBAFX,qDAEW;AAFF,oBANtB,4DAMsB,EALtB,0DAKsB,EAJtB,kEAIsB,EAHtB,0DAGsB,EAFtB,4EAEsB;AAEE,S;AAJF,O;;;;;;;;;;;;;;;;;ACf1B;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;AAAA;;;AAAA;AAAA;AAAA;;AAIA,UAAMC,MAAM,GAAW,CACrB;AACEC,YAAI,EAAE,EADR;AAEEC,iBAAS,EAAE;AAFb,OADqB,CAAvB;;UAWaC,sB;;;;;yBAAAA,sB;AAAsB,O;;;cAAtBA;;;kBAHF,CAAC,6DAAaC,QAAb,CAAsBJ,MAAtB,CAAD,C,EACC,4D;;;;4HAECG,sB,EAAsB;AAAA;AAAA,oBAFvB,4DAEuB;AAAA,S;AAFX,O;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACRxB;;AACE;;AACE;;AACF;;AAEA;;AACE;;AACE;;AACE;;AACF;;AACA;;AACE;;AACF;;AAEA;;AACE;;AAAW;;AAAU;;AACrB;;AACF;;AACF;;AAEA;;AACE;;AAAQ;AAAA;;AAAA;;AAAA;AAAA;;AACN;;AACF;;AACF;;AAOF;;AAEA;;AACE;;AACF;;AACF;;;;;;AA9BU;;AAAA;;AAeuB;;AAAA;;;;UCPpBE,S;AAKX,2BAAoBC,OAApB,EACoBC,WADpB,EAEoBC,aAFpB,EAGoBC,aAHpB,EAIoBC,gBAJpB,EAKoBC,kBALpB,EAMoBC,MANpB,EAOoBC,eAPpB,EAQoBC,QARpB,EASoBC,eATpB,EAUoBC,MAVpB,EAWoBC,GAXpB,EAYoBC,WAZpB,EAY8C;AAAA;;AAZ1B,eAAAZ,OAAA,GAAAA,OAAA;AACA,eAAAC,WAAA,GAAAA,WAAA;AACA,eAAAC,aAAA,GAAAA,aAAA;AACA,eAAAC,aAAA,GAAAA,aAAA;AACA,eAAAC,gBAAA,GAAAA,gBAAA;AACA,eAAAC,kBAAA,GAAAA,kBAAA;AACA,eAAAC,MAAA,GAAAA,MAAA;AACA,eAAAC,eAAA,GAAAA,eAAA;AACA,eAAAC,QAAA,GAAAA,QAAA;AACA,eAAAC,eAAA,GAAAA,eAAA;AACA,eAAAC,MAAA,GAAAA,MAAA;AACA,eAAAC,GAAA,GAAAA,GAAA;AACA,eAAAC,WAAA,GAAAA,WAAA;AAfpB,eAAAC,OAAA,GAAU,KAAV;AACA,eAAAC,mBAAA,GAAsB,IAAtB;AAeE,eAAKC,UAAL,GAAkB,KAAKd,WAAL,CAAiBe,KAAjB,CAAuB;AACvCC,iBAAK,EAAE,CAAC,EAAD,EAAK,0DAAWC,QAAhB,CADgC;AAEvCC,oBAAQ,EAAE,CAAC,EAAD,EAAK,0DAAWD,QAAhB,CAF6B;AAGvCE,oBAAQ,EAAE,CAAC,KAAD;AAH6B,WAAvB,CAAlB;AAKD;;;;iBAED,SAAAC,QAAQ,GAAG;AAAA;;AACT,iBAAKP,mBAAL,GAA2B,IAA3B;AACAQ,mBAAO,CAACC,GAAR,CAAY,CACV,KAAKvB,OAAL,CAAawB,GAAb,CAAiB,UAAjB,CADU,EAEV,KAAKxB,OAAL,CAAawB,GAAb,CAAiB,YAAjB,CAFU,CAAZ,EAGGC,IAHH,CAGQ,UAAAC,MAAM,EAAI;AAChB,kBAAMC,QAAQ,GAAGD,MAAM,CAAC,CAAD,CAAvB;AACA,kBAAME,SAAS,GAAGF,MAAM,CAAC,CAAD,CAAxB;AACAG,qBAAO,CAACC,GAAR,CAAY,KAAI,CAACtB,QAAL,CAAcuB,EAAd,CAAiB,WAAjB,CAAZ;;AACA,kBAAIJ,QAAQ,IAAIC,SAAhB,EAA2B;AACzB,oBAAI,KAAI,CAACpB,QAAL,CAAcuB,EAAd,CAAiB,WAAjB,CAAJ,EAAmC;AACjC,uBAAI,CAACC,aAAL;;AACA,uBAAI,CAACC,QAAL;AACD,iBAHD,MAGO;AACL,uBAAI,CAACC,uBAAL;AACD;AACF,eAPD,MAOO;AACL,qBAAI,CAACpB,mBAAL,GAA2B,KAA3B;AACD;AACF,aAjBD;AAkBD;;;iBAED,SAAAqB,MAAM,GAAG;AAAA;;AACP,gBAAMC,WAAW,GAAG;AAClBnB,mBAAK,EAAE,KAAKF,UAAL,CAAgBsB,KAAhB,CAAsBpB,KADX;AAElBE,sBAAQ,EAAE,KAAKJ,UAAL,CAAgBsB,KAAhB,CAAsBlB;AAFd,aAApB;AAIA,iBAAKJ,UAAL,CAAgBsB,KAAhB,CAAsBjB,QAAtB,GACI,KAAKpB,OAAL,CAAasC,GAAb,CAAiB,UAAjB,EAA6B,IAA7B,CADJ,GAEI,KAAKtC,OAAL,CAAasC,GAAb,CAAiB,UAAjB,EAA6B,KAA7B,CAFJ;AAGA,iBAAK1B,WAAL,CAAiBuB,MAAjB,CAAwBC,WAAxB,EACGG,SADH,CACa,UAACC,QAAD,EAAmB;AAC5B,kBAAMC,MAAM,GAAWD,QAAQ,CAACC,MAAhC;;AACA,oBAAI,CAACC,UAAL,CAAgBD,MAAhB;;AACA,oBAAI,CAAClC,eAAL,CAAqBoC,aAArB,CAAmCH,QAAQ,CAACI,SAA5C;;AACAtB,qBAAO,CAACC,GAAR,CAAY,CACV,MAAI,CAACvB,OAAL,CAAasC,GAAb,CAAiB,UAAjB,EAA6BE,QAAQ,CAACvB,KAAtC,CADU,EAEV,MAAI,CAACjB,OAAL,CAAasC,GAAb,CAAiB,YAAjB,EAA+BE,QAAQ,CAACK,WAAxC,CAFU,EAGV,MAAI,CAAC7C,OAAL,CAAasC,GAAb,CAAiB,YAAjB,EAA+BE,QAAQ,CAACM,UAAxC,CAHU,CAAZ,EAIGrB,IAJH,CAIQ,YAAM;AAEZ,sBAAI,CAACtB,aAAL,CAAmB4C,WAAnB;;AACA,sBAAI,CAACf,aAAL;;AACA,sBAAI,CAACC,QAAL;AACD,eATD;AAUD,aAfH,EAeK,UAAAe,KAAK,EAAI;AACV,oBAAI,CAACnC,OAAL,GAAe,KAAf;AACD,aAjBH;AAkBD;;;iBAED,SAAAoC,QAAQ,GAAG;AACT,iBAAK3C,MAAL,CAAY4C,aAAZ,CAA0B,UAA1B;AACD;;;iBAED,SAAAhB,uBAAuB,GAAG;AAAA;;AACxB,iBAAK9B,gBAAL,CAAsB+C,UAAtB,GAAmC1B,IAAnC,CAAwC,UAAC0B,UAAD,EAAyB;AAC/D,oBAAI,CAAC/C,gBAAL,CAAsBgD,OAAtB,CAA8B,MAAI,CAAChD,gBAAL,CAAsBiD,8BAApD,EACG5B,IADH,CACQ,YAAM;AACR,sBAAI,CAACO,aAAL;;AACA,sBAAI,CAAC1B,MAAL,CAAY4C,aAAZ,CAA0B,yBAA1B;AACD,eAJL,EAKI,UAAAF,KAAK,EAAI;AACPnB,uBAAO,CAACC,GAAR,CAAYkB,KAAZ;;AACA,sBAAI,CAACM,YAAL;AACD,eARL;AAUD,aAXD,WAWS,UAAAC,GAAG,EAAI;AACd1B,qBAAO,CAACC,GAAR,CAAYyB,GAAZ;AACD,aAbD;AAcD;;;iBAED,SAAAb,UAAU,CAACD,MAAD,EAAiB;AACzB,iBAAKvC,aAAL,CAAmBsD,UAAnB,CAA8Bf,MAA9B;AACD;;;iBAED,SAAAT,aAAa,GAAG;AACd,iBAAK3B,kBAAL,CAAwB2B,aAAxB;AACD;;;iBAED,SAAAC,QAAQ,GAAG;AACT;AACA,iBAAK3B,MAAL,CAAY4C,aAAZ,CAA0B,sBAA1B;AACD;;;iBAEK,SAAAI,YAAY,GAAG;;;;;;;AACL,2BAAM,KAAK7C,eAAL,CAAqBgD,MAArB,CAA4B;AAC9CC,6BAAO,EAAE,0CACP,qGAF4C;AAG9CC,6BAAO,EAAE,CAAC,IAAD;AAHqC,qBAA5B,CAAN;;;AAARC,yB;;AAMN,2BAAMA,KAAK,CAACC,OAAN,EAAN;;;;;;;AACD;;;iBAEK,SAAAC,kBAAkB,GAAG;;;;;;AACzBjC,2BAAO,CAACC,GAAR,CAAY,wBAAZ;;AACoB,2BAAM,KAAKpB,MAAL,CAAYqD,8BAAZ,CACxB,KAAKhD,UAAL,CAAgBsB,KAAhB,CAAsBpB,KADE,EAExB,KAAKF,UAAL,CAAgBsB,KAAhB,CAAsBpB,KAFE,CAAN;;;AAAdmB,+B;AAGNP,2BAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBM,WAAtB;AACM4B,uB,GAAM5B,WAAW,CAAC6B,IAAZ,CAAiBD,G;AAC7BnC,2BAAO,CAACC,GAAR,CAAYkC,GAAZ;;;;;;;AACD;;;;;yBA/HUjE,S,EAAS,wH,EAAA,4H,EAAA,2I,EAAA,2I,EAAA,sJ,EAAA,qJ,EAAA,wH,EAAA,gJ,EAAA,yH,EAAA,gI,EAAA,qI,EAAA,2I,EAAA,uI;AAAA,O;;;cAATA,S;AAAS,kC;AAAA,gB;AAAA,e;AAAA,wf;AAAA;AAAA;ADdtB;;;;AAAc","file":"pages-login-login-module-es5.js","sourcesContent":["import {NgModule} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {FormsModule, ReactiveFormsModule} from '@angular/forms';\n\nimport {IonicModule} from '@ionic/angular';\n\nimport {LoginPageRoutingModule} from './login-routing.module';\n\nimport {LoginPage} from './login.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    IonicModule,\n    LoginPageRoutingModule\n  ],\n  declarations: [LoginPage]\n})\nexport class LoginPageModule {\n}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { LoginPage } from './login.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: LoginPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class LoginPageRoutingModule {}\n","<!--<ion-header *ngIf=\"!checkingCredentials\" no-border translucent>-->\n<!--  <ion-toolbar no-border mode=\"ios\">-->\n<!--    <ion-title color=\"primary\">DistriApp</ion-title>-->\n<!--  </ion-toolbar>-->\n<!--</ion-header>-->\n\n<ion-content *ngIf=\"!checkingCredentials\">\n  <div class=\"header\">\n    <img src=\"assets/logo.png\" alt=\"DistriApp\">\n  </div>\n\n  <div class=\"content\">\n    <form [formGroup]=\"signInForm\">\n      <div class=\"form-group\">\n        <input type=\"text\" placeholder=\"Correo electrónico\" formControlName=\"email\" inputmode=\"email\">\n      </div>\n      <div class=\"form-group\">\n        <input type=\"password\" placeholder=\"Contraseña\" formControlName=\"password\">\n      </div>\n\n      <ion-item lines=\"none\">\n        <ion-label>Recordarme</ion-label>\n        <ion-checkbox formControlName=\"checkbox\" slot=\"end\" color=\"primary\"></ion-checkbox>\n      </ion-item>\n    </form>\n\n    <div class=\"ion-text-center ion-margin\">\n      <button (click)=\"signIn()\" [disabled]=\"!signInForm.valid\">\n        INGRESAR\n      </button>\n    </div>\n\n<!--    <div class=\"ion-text-center ion-margin\">-->\n<!--      <button (click)=\"register()\" [disabled]=\"!signInForm.valid\">-->\n<!--        CREAR CUENTA-->\n<!--      </button>-->\n<!--    </div>-->\n  </div>\n\n  <div class=\"footer\">\n    V3.2.5\n  </div>\n</ion-content>\n\n","import {Component, OnInit} from '@angular/core';\nimport {Storage} from '@ionic/storage';\nimport {FormBuilder, FormGroup, Validators} from '@angular/forms';\nimport {AuthService} from '../../services/v1/auth.service';\nimport {DriverService} from '../../services/v1/driver.service';\nimport {DeviceService} from '../../services/v1/device.service';\nimport {Driver} from '../../interfaces/Driver';\nimport {GeolocationService} from '../../services/v1/geolocation.service';\nimport {Router} from '@angular/router';\nimport {LocationAccuracy} from '@ionic-native/location-accuracy/ngx';\nimport {AlertController, Platform} from '@ionic/angular';\nimport {LocationService} from '../../services/v1/location.service';\nimport {AngularFireAuth} from '@angular/fire/auth';\nimport {AngularFirestore} from '@angular/fire/firestore';\n\n@Component({\n  selector: 'app-login',\n  templateUrl: './login.page.html',\n  styleUrls: ['./login.page.scss'],\n})\nexport class LoginPage implements OnInit {\n  signInForm: FormGroup;\n  loading = false;\n  checkingCredentials = true;\n\n  constructor(private storage: Storage,\n              private formBuilder: FormBuilder,\n              private driverService: DriverService,\n              private deviceService: DeviceService,\n              private locationAccuracy: LocationAccuracy,\n              private geolocationService: GeolocationService,\n              private router: Router,\n              private locationService: LocationService,\n              private platform: Platform,\n              private alertController: AlertController,\n              private afAuth: AngularFireAuth,\n              private afs: AngularFirestore,\n              private authService: AuthService) {\n    this.signInForm = this.formBuilder.group({\n      email: ['', Validators.required],\n      password: ['', Validators.required],\n      checkbox: [false]\n    });\n  }\n\n  ngOnInit() {\n    this.checkingCredentials = true;\n    Promise.all([\n      this.storage.get('remember'),\n      this.storage.get('auth_token')\n    ]).then(values => {\n      const remember = values[0];\n      const authToken = values[1];\n      console.log(this.platform.is('mobileweb'));\n      if (remember && authToken) {\n        if (this.platform.is('mobileweb')) {\n          this.watchPosition();\n          this.navigate();\n        } else {\n          this.requestLocationAccuracy();\n        }\n      } else {\n        this.checkingCredentials = false;\n      }\n    });\n  }\n\n  signIn() {\n    const credentials = {\n      email: this.signInForm.value.email,\n      password: this.signInForm.value.password\n    };\n    this.signInForm.value.checkbox\n      ? this.storage.set('remember', true)\n      : this.storage.set('remember', false);\n    this.authService.signIn(credentials)\n      .subscribe((response: any) => {\n        const driver: Driver = response.driver;\n        this.setProfile(driver);\n        this.locationService.setLocations$(response.locations);\n        Promise.all([\n          this.storage.set('senderId', response.email),\n          this.storage.set('adminEmail', response.admin_email),\n          this.storage.set('auth_token', response.auth_token)\n        ]).then(() => {\n\n          this.deviceService.storeDevice();\n          this.watchPosition();\n          this.navigate();\n        });\n      }, error => {\n        this.loading = false;\n      });\n  }\n\n  register() {\n    this.router.navigateByUrl('register');\n  }\n\n  requestLocationAccuracy() {\n    this.locationAccuracy.canRequest().then((canRequest: boolean) => {\n      this.locationAccuracy.request(this.locationAccuracy.REQUEST_PRIORITY_HIGH_ACCURACY)\n        .then(() => {\n            this.watchPosition();\n            this.router.navigateByUrl('urban-distribution-list');\n          },\n          error => {\n            console.log(error);\n            this.presentAlert();\n          }\n        );\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  setProfile(driver: Driver) {\n    this.driverService.setDriver$(driver);\n  }\n\n  watchPosition() {\n    this.geolocationService.watchPosition();\n  }\n\n  navigate() {\n    // this.router.navigateByUrl('urban-distribution-list');\n    this.router.navigateByUrl('profile/profile-data');\n  }\n\n  async presentAlert() {\n    const alert = await this.alertController.create({\n      message: 'No se pudo obtener ubicación actual. ' +\n        'Por favor concede los permisos para que la aplicación pueda utilizar el GPS de su dispositivo móvil',\n      buttons: ['OK']\n    });\n\n    await alert.present();\n  }\n\n  async createFirebaseUser() {\n    console.log('creating firebase user');\n    const credentials = await this.afAuth.createUserWithEmailAndPassword(\n      this.signInForm.value.email,\n      this.signInForm.value.email);\n    console.log('result', credentials);\n    const uid = credentials.user.uid;\n    console.log(uid);\n  }\n}\n"]}