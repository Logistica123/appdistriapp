<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button autoHide="false"></ion-menu-button>
    </ion-buttons>
    <ion-title>MANTENIMIENTO</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-progress-bar class="ion-margin-top"
                    type="indeterminate"
                    *ngIf="loading || uploading">
  </ion-progress-bar>

  <ion-note class="ion-text-center ion-padding" color="danger"
            *ngIf="!loading && errorMessage && !hasPersonaLoaded">
    {{ errorMessage }}
  </ion-note>

  <div class="ion-text-center ion-padding-bottom">
    <ion-button class="custom-button"
                (click)="triggerFileSelection()"
                [disabled]="uploading || !hasPersonaLoaded">
      Seleccionar archivos
    </ion-button>
    <ion-button color="primary"
                (click)="uploadSelectedFiles()"
                [disabled]="uploading || selectedFiles.length === 0 || !hasPersonaLoaded">
      Subir liquidaciones
    </ion-button>
    <ion-note class="ion-margin-top" *ngIf="selectedFiles.length > 0">
      {{ selectedFiles.length }} archivo{{ selectedFiles.length === 1 ? '' : 's' }} seleccionado{{ selectedFiles.length === 1 ? '' : 's' }}.
      <ion-button fill="clear" size="small" (click)="clearSelectedFiles()">Limpiar</ion-button>
    </ion-note>
  </div>

  <input #fileInput
         type="file"
         hidden
         multiple
         (change)="onFilesSelected($event)"
         accept=".pdf,.png,.jpg,.jpeg,.doc,.docx,.xls,.xlsx">

  <ion-card *ngIf="persona">
    <ion-card-header>
      <ion-card-title>Liquidaciones de {{ persona?.nombre }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-note *ngIf="errorMessage && (!liquidaciones || liquidaciones.length === 0)">
        {{ errorMessage }}
      </ion-note>

      <ion-list *ngIf="!loading && liquidaciones.length > 0">
        <ion-item *ngFor="let liquidacion of liquidaciones">
          <ion-label>
            <h2>{{ liquidacion.nombre }}</h2>
            <p *ngIf="liquidacion.tipoNombre">{{ liquidacion.tipoNombre }}</p>
            <p>
              {{ liquidacion.fechaCarga ? (liquidacion.fechaCarga | date:'dd/MM/yyyy') : 'Sin fecha' }}
              <span *ngIf="liquidacion.sizeLabel"> · {{ liquidacion.sizeLabel }}</span>
            </p>
          </ion-label>
          <ion-button fill="clear" slot="end" (click)="openLiquidacion(liquidacion)">
            <ion-icon slot="icon-only" name="download"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>

      <ion-note *ngIf="!loading && liquidaciones.length === 0 && !errorMessage">
        Aún no hay liquidaciones cargadas. Seleccioná archivos para subirlos.
      </ion-note>
    </ion-card-content>
  </ion-card>

  <ion-note class="ion-text-center ion-padding" color="danger"
            *ngIf="!loading && errorMessage && liquidaciones.length > 0">
    {{ errorMessage }}
  </ion-note>
</ion-content>
