<ion-content class="ion-text-center">
  <ion-progress-bar class="ion-margin-top"
                    type="indeterminate"
                    *ngIf="loading">
  </ion-progress-bar>

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <input #fileInput type="file" accept="image/*" hidden (change)="onFileSelected($event)">

  <div *ngIf="driver">
    <div class="ion-margin-top">
      <img src="assets/images/default_profile_img.png" alt="profile_img"
           *ngIf="filesSrc.length <= 0 && !driver?.has_profile_img" (click)="pickImage()">

      <img [src]="filesSrc[0]" alt="profile_img"
           *ngIf="filesSrc.length > 0" (click)="pickImage()">

      <img [src]="profileImg" alt="profile_img"
           *ngIf="filesSrc.length <= 0 && driver?.has_profile_img && profileImg" (click)="pickImage()">
    </div>

    <div class="photo-actions ion-margin">
      <div class="action-pill change-photo-action" (click)="pickImage()">
        {{ driver?.has_profile_img || filesSrc.length > 0 ? 'Cambiar foto' : 'Agregar foto' }}
      </div>
      <div class="action-pill delete-photo-action"
           [class.disabled]="!canDeletePhoto()"
           (click)="handleDeletePhoto()">
        Eliminar foto
      </div>
    </div>

    <div class="ion-text-center ion-margin" *ngIf="filesSrc.length > 0">
      <div class="update-profile-image small" (click)="uploadFile()">
        Guardar nueva imagen de perfil
      </div>
    </div>

    <div class="ion-text-center ion-margin">
      <div class="update-password small" (click)="updatePassword()">
        Cambiar contraseña
      </div>
    </div>

    <div class="ion-text-center ion-margin">
      <div class="update-password small" (click)="updateProfile()">
        Editar información
      </div>
    </div>

    <ion-grid class="contractor-toggle">
      <ion-row>
        <ion-col size="4" class="ion-align-self-center">
          Terceros
        </ion-col>
        <ion-col size="4">
          <ion-toggle color="light"
                      (ionChange)="onToggleChange($event)"
                      [checked]="driver?.contractor === 'logistic_company'">
          </ion-toggle>
        </ion-col>
        <ion-col size="4" class="ion-align-self-center">
          Empresa logística
        </ion-col>
      </ion-row>
    </ion-grid>

    <ion-grid class="profile-data">
      <ion-row>
        <ion-col size="6">Ciudad</ion-col>
        <ion-col size="6">{{driver?.city}}</ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="6">Teléfono</ion-col>
        <ion-col size="6">{{driver?.phone_number}}</ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="6">CBU</ion-col>
        <ion-col size="6" class="break-word">{{driver?.bank_cbu || 'Sin registrar'}}</ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="6">Titular</ion-col>
        <ion-col size="6">{{driver?.bank_owner_is_driver ? 'Conductor' : (driver?.bank_holder_name || 'No informado')}}
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="6">Empresa</ion-col>
        <ion-col size="6">{{driver?.company || 'Sin registrar'}}</ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="6">Matrícula</ion-col>
        <ion-col size="6">{{driver?.license_plate || 'Sin registrar'}}</ion-col>
      </ion-row>
    </ion-grid>

    <div class="metric-card">
      <p class="distance-value">{{distance}} km.</p>
      <p class="distance-text">Distancia cubierta</p>
    </div>

    <div class="metric-card metric-card--alt">
      <p class="distance-value">{{duration}} h.</p>
      <p class="distance-text">Tiempo cubierto</p>
    </div>
  </div>
</ion-content>
